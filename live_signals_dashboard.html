<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Signal Dashboard - FVG/IFVG Real-time Analytics</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style>
        
        .dashboard-container { display: grid; grid-template-columns: 250px 1fr; grid-template-rows: auto 1fr; height: 100vh; gap: 10px; padding: 10px; }
        .sidebar { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 20px; backdrop-filter: blur(10px); overflow-y: auto; }
        
        .main-content { display: grid; grid-template-rows: 200px 300px 1fr; gap: 10px; }
        .metrics-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        
        .signals-timeline { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 20px; backdrop-filter: blur(10px); overflow-y: auto; max-height: 300px; }
        
        .timeline-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .timeline-signal {
            background: rgba(255,255,255,0.08);
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #00ff88;
            transition: all 0.3s ease;
            animation: slideIn 0.5s ease;
        }
        
        .timeline-signal.bearish {
            border-left-color: #ff4757;
        }
        
        .timeline-signal:hover {
            background: rgba(255,255,255,0.12);
            transform: translateX(5px);
        }
        
        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .signal-symbol {
            font-weight: bold;
            font-size: 16px;
        }
        
        .signal-time {
            font-size: 12px;
            opacity: 0.7;
        }
        
        .signal-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            font-size: 12px;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .signals-container { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 20px; backdrop-filter: blur(10px); overflow-y: auto; }
        
        .signals-table-container {
            overflow-y: auto;
            max-height: 400px;
        }
        
        .signals-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .signals-table th {
            background: rgba(255,255,255,0.1);
            padding: 8px 4px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            position: sticky;
            top: 0;
        }
        
        .signals-table td {
            padding: 8px 4px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            vertical-align: top;
        }
        
        .signals-table tr:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .signal-bullish { color: #00ff88; }
        .signal-bearish { color: #ff4757; }
        .signal-neutral { color: #ffa502; }
        

        
        .no-signals { text-align: center; padding: 40px 20px; opacity: 0.7; font-style: italic; }
        
        .timeframe-tabs { display: flex; gap: 5px; margin-bottom: 15px; }
        .timeframe-tab { padding: 8px 12px; background: rgba(255,255,255,0.1); border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 12px; transition: all 0.3s ease; }
        .timeframe-tab.active { background: #00ff88; color: #000; }
        

        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-live { background: #00ff88; animation: pulse 2s infinite; }
        .status-offline { background: #ff4757; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        

    </style>
</head>
<body>
    <nav style="background: #141b3d; padding: 12px 20px; margin-bottom: 20px; border-bottom: 1px solid #2d3a5f; display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
        <a href="/ml-dashboard" data-page="ml" style="padding: 8px 12px; background: #1a2142; color: #f8fafc; text-decoration: none; border-radius: 6px; font-size: 14px; white-space: nowrap;">ü§ñ ML</a>
        <a href="/live-signals-dashboard" data-page="live" style="padding: 8px 12px; background: #1a2142; color: #f8fafc; text-decoration: none; border-radius: 6px; font-size: 14px; white-space: nowrap;">üì∂ Live</a>
        <a href="/signal-lab-dashboard" data-page="dashboard" style="padding: 8px 12px; background: #1a2142; color: #f8fafc; text-decoration: none; border-radius: 6px; font-size: 14px; white-space: nowrap;">üè† Dashboard</a>
        <a href="/signal-analysis-lab" data-page="lab" style="padding: 8px 12px; background: #1a2142; color: #f8fafc; text-decoration: none; border-radius: 6px; font-size: 14px; white-space: nowrap;">üß™ Signal Lab</a>
        <a href="/time-analysis" data-page="time" style="padding: 8px 12px; background: #1a2142; color: #f8fafc; text-decoration: none; border-radius: 6px; font-size: 14px; white-space: nowrap;">‚è∞ Time</a>
        <a href="/strategy-optimizer" data-page="optimizer" style="padding: 8px 12px; background: #1a2142; color: #f8fafc; text-decoration: none; border-radius: 6px; font-size: 14px; white-space: nowrap;">üéØ Optimizer</a>
        <a href="/strategy-comparison" data-page="compare" style="padding: 8px 12px; background: #1a2142; color: #f8fafc; text-decoration: none; border-radius: 6px; font-size: 14px; white-space: nowrap;">üèÜ Compare</a>
        <a href="/ai-business-advisor" data-page="advisor" style="padding: 8px 12px; background: #1a2142; color: #f8fafc; text-decoration: none; border-radius: 6px; font-size: 14px; white-space: nowrap;">üß† AI Advisor</a>
        <a href="/prop-portfolio" data-page="prop" style="padding: 8px 12px; background: #1a2142; color: #f8fafc; text-decoration: none; border-radius: 6px; font-size: 14px; white-space: nowrap;">üíº Prop</a>
        <a href="/trade-manager" data-page="trades" style="padding: 8px 12px; background: #1a2142; color: #f8fafc; text-decoration: none; border-radius: 6px; font-size: 14px; white-space: nowrap;">üìã Trades</a>
        <a href="/financial-summary" data-page="finance" style="padding: 8px 12px; background: #1a2142; color: #f8fafc; text-decoration: none; border-radius: 6px; font-size: 14px; white-space: nowrap;">üí∞ Finance</a>
        <a href="/reporting-hub" data-page="reports" style="padding: 8px 12px; background: #1a2142; color: #f8fafc; text-decoration: none; border-radius: 6px; font-size: 14px; white-space: nowrap;">üìä Reports</a>
    </nav>
    <script>
    (function() {
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('nav a[data-page]');
        navLinks.forEach(link => {
            if (link.getAttribute('href') === currentPath) {
                link.style.background = '#3b82f6';
                link.style.color = 'white';
            }
        });
    })();
    </script>
    <div class="dashboard-container">
        <div class="header">
            <div style="margin-left: auto; display: flex; align-items: center; gap: 10px;">
                <span class="status-indicator status-live"></span>
                <span>Live Feed</span>
                <span id="lastUpdate">--:--</span>
            </div>
        </nav>
        
        <div class="sidebar">
            <h3>Timeframes</h3>
            <div class="timeframe-tabs">
                <button class="timeframe-tab active" onclick="switchTimeframe('1m')">1M</button>
                <button class="timeframe-tab" onclick="switchTimeframe('5m')">5M</button>
                <button class="timeframe-tab" onclick="switchTimeframe('15m')">15M</button>
                <button class="timeframe-tab" onclick="switchTimeframe('1h')">1H</button>
            </div>
            
            <h3>Signal Filters</h3>
            <div style="margin: 10px 0;">
                <label><input type="checkbox" checked> Bullish FVG</label><br>
                <label><input type="checkbox" checked> Bearish FVG</label><br>
                <label><input type="checkbox" checked> Bullish IFVG</label><br>
                <label><input type="checkbox" checked> Bearish IFVG</label><br>
            </div>
            
            <h3>Symbol Filters</h3>
            <div style="margin: 10px 0;">
                <label><input type="checkbox" id="filter-NQ" checked> NQ1!</label><br>
                <label><input type="checkbox" id="filter-OTHER"> Other</label>
            </div>
            
            <h3>Session Times</h3>
            <div id="sessionTimesDisplay" style="font-size: 11px; line-height: 1.3; margin: 10px 0; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 5px;">
            </div>
        </div>
        
        <div class="main-content">
            <div class="metrics-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalSignals">0</div>
                    <div class="stat-label">Total Signals</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="bullishSignals">0</div>
                    <div class="stat-label">Bullish</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="bearishSignals">0</div>
                    <div class="stat-label">Bearish</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgStrength">--</div>
                    <div class="stat-label">Avg Strength</div>
                </div>
            </div>
            
            <div class="signals-timeline">
                <h3>Live Signals Timeline</h3>
                <div id="signalsTimeline" class="timeline-container">
                    <div class="no-signals">Waiting for signals...</div>
                </div>
            </div>
            
            <div class="signals-container">
                <h3>Live Signals Feed</h3>
                <div class="signals-table-container">
                    <table class="signals-table" id="signalsTable">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Session</th>
                                <th>Symbol</th>
                                <th>Triangle Bias</th>

                                <th>Price</th>
                                <th>Strength</th>
                                <th>NQ Context</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="signalsFeed">
                            <!-- Signals will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        

    </div>

    <script>
        let currentTimeframe = '1m';
        let signals = [];
        let wsConnection = null;
        
        function isDST(date) {
            const year = date.getFullYear();
            const marchSecondSunday = new Date(year, 2, 1);
            marchSecondSunday.setDate(1 + (7 - marchSecondSunday.getDay() + 7) % 7 + 7);
            const novFirstSunday = new Date(year, 10, 1);
            novFirstSunday.setDate(1 + (7 - novFirstSunday.getDay()) % 7);
            return date >= marchSecondSunday && date < novFirstSunday;
        }
        
        function displaySessionTimes() {
            const now = new Date();
            const dst = isDST(now);
            const offset = dst ? 0 : 1;
            const container = document.getElementById('sessionTimesDisplay');
            
            // Official NASDAQ session times (EST/EDT)
            const sessions = [
                { name: 'ASIA', time: '20:00-23:59' },
                { name: 'LONDON', time: '00:00-05:59' },
                { name: 'NY PRE', time: '06:00-08:29' },
                { name: 'NY AM', time: '08:30-11:59' },
                { name: 'NY LUNCH', time: '12:00-12:59' },
                { name: 'NY PM', time: '13:00-15:59' }
            ];
            
            let html = `<div style="font-size: 10px; opacity: 0.7; margin-bottom: 5px;">Official NASDAQ Session Times (EST/EDT)</div>`;
            sessions.forEach(s => {
                html += `<div><strong>${s.name}:</strong> ${s.time}</div>`;
            });
            container.innerHTML = html;
        }
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            signals = [];
            displaySessionTimes();
            initializeWebSocket();
            loadHistoricalSignals();
            startMetricsUpdate();
        });
        
        // WebSocket connection for real-time signals
        function initializeWebSocket() {
            try {
                // Connect to SocketIO
                const socket = io();
                
                socket.on('connect', function() {
                    console.log('WebSocket connected');
                    updateConnectionStatus(true);
                });
                
                socket.on('disconnect', function() {
                    console.log('WebSocket disconnected');
                    updateConnectionStatus(false);
                });
                
                socket.on('new_signal', function(signal) {
                    console.log('New signal received:', signal);
                    addNewSignal(signal);
                    updateMetrics();
                });
                
                // Fallback polling every 60 seconds
                setInterval(loadHistoricalSignals, 60000);
                
            } catch (error) {
                console.error('WebSocket connection failed:', error);
                updateConnectionStatus(false);
                // Fallback to polling
                setInterval(loadHistoricalSignals, 10000);
            }
        }
        
        // Load historical signals
        async function loadHistoricalSignals() {
            try {
                const response = await fetch('/api/live-signals?timeframe=' + currentTimeframe, {
                    timeout: 5000
                });
                if (!response.ok) throw new Error('Network response not ok');
                const data = await response.json();
                
                // Merge with existing signals to maintain persistence
                const newSignals = data.signals || [];
                const existingIds = signals.map(s => s.id);
                const uniqueNewSignals = newSignals.filter(s => !existingIds.includes(s.id));
                
                signals = [...uniqueNewSignals, ...signals].slice(0, 100);
                
                updateSignalsFeed();
                updateMetrics();
                updateLastUpdateTime();
            } catch (error) {
                // Silently handle errors to reduce console spam
                updateSignalsFeed();
                updateMetrics();
            }
        }
        
        // Add new signal to feed
        function addNewSignal(signal) {
            // Remove any existing signal with same ID to prevent duplicates
            signals = signals.filter(s => s.id !== signal.id);
            
            // Ensure timestamp is properly formatted for NY timezone
            if (signal.timestamp) {
                signal.timestamp = new Date(signal.timestamp).toISOString();
            }
            
            signals.unshift(signal);
            if (signals.length > 50) {
                signals = signals.slice(0, 50); // Keep last 50 signals for better performance
            }
            updateSignalsFeed();
            updateLastUpdateTime();
            
            // Highlight new signal briefly
            setTimeout(() => {
                const newSignalElement = document.querySelector('.signal-item');
                if (newSignalElement) {
                    newSignalElement.style.backgroundColor = 'rgba(0,255,136,0.2)';
                    setTimeout(() => {
                        newSignalElement.style.backgroundColor = '';
                    }, 2000);
                }
            }, 100);
        }
        
        // Update signals feed display
        function updateSignalsFeed() {
            const feed = document.getElementById('signalsFeed');
            
            if (!signals || signals.length === 0) {
                feed.innerHTML = '<tr><td colspan="9" class="no-signals">No signals yet. Waiting for TradingView alerts...</td></tr>';
                return;
            }
            
            // Filter signals by selected symbols - focus on NQ HTF aligned signals
            const filteredSignals = signals.filter(signal => {
                const symbol = signal.symbol || '';
                if (symbol.includes('NQ')) return document.getElementById('filter-NQ').checked;
                return document.getElementById('filter-OTHER').checked;
            });
            
            if (filteredSignals.length === 0) {
                feed.innerHTML = '<tr><td colspan="9" class="no-signals">No signals match current filters...</td></tr>';
                return;
            }
            
            // Update signals timeline
            updateSignalsTimeline(filteredSignals);
            
            feed.innerHTML = filteredSignals.map(signal => createSignalRow(signal)).join('');
        }
        
        // Update signals timeline
        function updateSignalsTimeline(signals) {
            const timeline = document.getElementById('signalsTimeline');
            
            if (!signals || signals.length === 0) {
                timeline.innerHTML = '<div class="no-signals">Waiting for signals...</div>';
                return;
            }
            
            timeline.innerHTML = signals.slice(0, 10).map(signal => {
                const bias = signal.bias || 'Neutral';
                const arrow = bias === 'Bullish' ? '‚ñ≤' : bias === 'Bearish' ? '‚ñº' : '‚óÜ';
                const time = formatTime(signal.timestamp);
                
                return `
                    <div class="timeline-signal ${bias.toLowerCase()}">
                        <div class="signal-header">
                            <div class="signal-symbol">${signal.symbol || 'Unknown'} ${arrow} ${bias.toUpperCase()}</div>
                            <div class="signal-time">${time}</div>
                        </div>
                        <div class="signal-details">
                            <div>Price: <strong>${parseFloat(signal.price || 0).toLocaleString()}</strong></div>
                            <div>ML: <strong>${signal.strength ? Math.round(signal.strength) + '%' : 'Pending'}</strong></div>
                            <div>Session: <strong>${signal.session || 'N/A'}</strong></div>
                        </div>
                        <div style="margin-top: 10px; text-align: right;">
                            <button onclick="sendToSignalLab(${signal.id})" style="background: #00ff88; border: none; padding: 5px 12px; border-radius: 5px; color: #000; font-size: 11px; cursor: pointer; font-weight: 600;">‚Üí Signal Lab</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Capture signal for ML learning
        function captureSignalForML(signal) {
            try {
                const mlData = {
                    timestamp: new Date().toISOString(),
                    symbol: signal.symbol,
                    bias: signal.bias,
                    price: signal.price,
                    strength: signal.strength,
                    htf_aligned: signal.htf_aligned,
                    htf_status: signal.htf_status,
                    session: signal.session,
                    timeframe: signal.timeframe || '1m',
                    signal_type: signal.signal_type
                };
                
                // Store in localStorage for ML training data
                let mlSignals = JSON.parse(localStorage.getItem('ml_signals') || '[]');
                mlSignals.unshift(mlData);
                
                // Keep last 1000 signals for ML training
                if (mlSignals.length > 1000) {
                    mlSignals = mlSignals.slice(0, 1000);
                }
                
                localStorage.setItem('ml_signals', JSON.stringify(mlSignals));
                
                console.log('Signal captured for ML:', mlData);
            } catch (error) {
                console.error('Error capturing signal for ML:', error);
            }
        }
        
        // Create signal table row
        function createSignalRow(signal) {
            const bias = signal.bias || 'Neutral';
            const biasClass = `signal-${bias.toLowerCase()}`;
            

            
            // Show triangle direction with arrow and details
            const arrow = bias === 'Bullish' ? '‚ñ≤' : bias === 'Bearish' ? '‚ñº' : '‚óÜ';
            let signalDetail = signal.fvg_detail || signal.signal_type || 'FVG';
            

            
            const triangleDisplay = `
                <div class="${biasClass}"><strong>${arrow} ${bias.toUpperCase()}</strong></div>
                <div style="font-size: 10px; opacity: 0.8;">
                    ${signalDetail}<br>
                    ${signal.strength ? 'ML: ' + Math.round(signal.strength) + '%' : 'ML: Pending'}
                </div>
            `;
            
            // HTF Status display - fix boolean check
            // NQ Context
            let nqContext = '';
            let nqContextClass = '';
            let action = '';
            let actionClass = '';
            const symbol = signal.symbol || '';
            
            if (symbol.includes('NQ')) {
                if (bias === 'Bullish') {
                    nqContext = 'üü¢ HTF Aligned Long';
                    nqContextClass = 'signal-bullish';
                    action = 'Long FVG';
                    actionClass = 'signal-bullish';
                } else {
                    nqContext = 'üî¥ HTF Aligned Short';
                    nqContextClass = 'signal-bearish';
                    action = 'Short FVG';
                    actionClass = 'signal-bearish';
                }
            } else {
                nqContext = '‚ö™ Monitor';
                nqContextClass = 'signal-neutral';
                action = 'Monitor';
                actionClass = 'signal-neutral';
            }
            
            const rowClass = biasClass;
            
            return `
                <tr class="${rowClass}">
                    <td>${formatTime(signal.timestamp)}</td>
                    <td style="font-size: 10px;">${signal.session || getSession(signal.timestamp)}</td>
                    <td><strong>${signal.symbol || 'N/A'}</strong></td>
                    <td>${triangleDisplay}</td>

                    <td>${parseFloat(signal.price || 0).toLocaleString()}</td>
                    <td>${Math.round(signal.strength || 0)}%</td>
                    <td style="font-size: 11px;" class="${nqContextClass}">${nqContext}</td>
                    <td style="font-size: 11px; font-weight: bold;" class="${actionClass}">${action}</td>
                </tr>
            `;
        }
        
        // Update metrics
        function updateMetrics() {
            const total = signals.length;
            const bullish = signals.filter(s => s.bias === 'Bullish').length;
            const bearish = signals.filter(s => s.bias === 'Bearish').length;
            const avgStrength = signals.length > 0 ? 
                (signals.reduce((sum, s) => sum + (parseFloat(s.strength) || 0), 0) / signals.length).toFixed(1) : '--';
            
            document.getElementById('totalSignals').textContent = total;
            document.getElementById('bullishSignals').textContent = bullish;
            document.getElementById('bearishSignals').textContent = bearish;
            document.getElementById('avgStrength').textContent = avgStrength !== '--' ? avgStrength + '%' : '--';
        }
        
        // Switch timeframe
        function switchTimeframe(timeframe) {
            currentTimeframe = timeframe;
            
            // Update active tab
            document.querySelectorAll('.timeframe-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Reload signals for new timeframe
            loadHistoricalSignals();
        }
        
        // Add event listeners for symbol filters
        document.addEventListener('DOMContentLoaded', function() {
            ['filter-NQ', 'filter-OTHER'].forEach(id => {
                document.getElementById(id).addEventListener('change', updateSignalsFeed);
            });
        });
        

        
        // Update connection status
        function updateConnectionStatus(connected) {
            const indicator = document.querySelector('.status-indicator');
            const text = indicator.nextElementSibling;
            
            if (connected) {
                indicator.className = 'status-indicator status-live';
                text.textContent = 'Live Feed Active';
            } else {
                indicator.className = 'status-indicator status-offline';
                text.textContent = 'Polling for Signals';
            }
        }
        
        // Update last update time
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {
                timeZone: 'America/New_York',
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('lastUpdate').textContent = `Last: ${timeString}`;
        }
        
        // Format timestamp to match TradingView exchange time (EST/EDT)
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('en-US', { 
                timeZone: 'America/New_York', // Automatically handles EST (-5) / EDT (-4)
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        function getSession(timestamp) {
            const date = new Date(timestamp);
            const nyTime = new Date(date.toLocaleString("en-US", {timeZone: "America/New_York"}));
            const hour = nyTime.getHours();
            const minute = nyTime.getMinutes();
            const dst = isDST(nyTime);
            const offset = dst ? 0 : 1;
            
            if (hour >= (20 + offset) || hour <= (23 + offset)) return 'Asia';
            if (hour >= (0 + offset) && hour <= (5 + offset)) return 'London';
            if (hour >= (6 + offset) && (hour < (8 + offset) || (hour === (8 + offset) && minute < 30))) return 'NY Pre';
            if ((hour === (8 + offset) && minute >= 30) || (hour > (8 + offset) && hour <= (11 + offset))) return 'NY AM';
            if (hour === (12 + offset)) return 'NY Lunch';
            if (hour >= (13 + offset) && hour <= (15 + offset)) return 'NY PM';
            return 'After Hours';
        }
        
        // Send signal to Signal Lab
        window.sendToSignalLab = async function(signalId) {
            try {
                const signal = signals.find(s => s.id === signalId);
                if (!signal) {
                    alert('Signal not found');
                    return;
                }
                
                // Focus only on NQ HTF aligned signals
                
                const tradeData = {
                    date: new Date(signal.timestamp).toISOString().split('T')[0],
                    time: new Date(signal.timestamp).toTimeString().split(' ')[0],
                    bias: signal.bias,
                    session: signal.session,
                    signal_type: signal.signal_type || 'FVG',
                    entry_price: signal.price,
                    mfe_none: null, // Will be filled by user
                    active_trade: true // Mark as active
                };
                
                const response = await fetch('/api/signal-lab-trades', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(tradeData)
                });
                
                if (response.ok) {
                    alert('Signal sent to 1M Signal Lab!\nGo to Signal Lab to input your R result.');
                } else {
                    alert('Failed to send signal to Signal Lab');
                }
            } catch (error) {
                console.error('Error sending to Signal Lab:', error);
                alert('Error sending signal to Signal Lab');
            }
        };
        
        // Auto-refresh signals every 5 seconds
        setInterval(() => {
            if (document.visibilityState === 'visible') {
                loadHistoricalSignals();
            }
        }, 5000);
        
        // Start metrics update interval
        function startMetricsUpdate() {
            // Removed unused functions
        }
    </script>
</body>
</html>