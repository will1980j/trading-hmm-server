<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradingView Integration - Trading Analytics</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --accent-color: #00ff88;
            --glass-bg: rgba(255,255,255,0.08);
            --glass-border: rgba(255,255,255,0.1);
            --shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            margin: 0;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .navbar {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 15px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .nav-link {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            padding: 10px 18px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .nav-link:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .nav-link.active {
            color: #00ff88;
            background: rgba(0,255,136,0.15);
            border-color: rgba(0,255,136,0.3);
        }
        
        .header {
            text-align: center;
            padding: 30px;
            background: rgba(255,255,255,0.08);
            border-radius: 20px;
            backdrop-filter: blur(20px);
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00ff88, #00d4aa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .integration-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .integration-card {
            background: rgba(255,255,255,0.08);
            border-radius: 18px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .webhook-url {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            margin: 15px 0;
            word-break: break-all;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-active { background: #00ff88; }
        .status-inactive { background: #ff4757; }
        
        .btn {
            background: linear-gradient(45deg, var(--accent-color), #00d4aa);
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,255,136,0.3);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .alert-log {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .alert-item {
            padding: 8px;
            margin: 5px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
            border-left: 3px solid #00ff88;
        }
        
        .pine-script {
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; gap: 15px; align-items: center; justify-content: center; flex: 1;">
                <a href="advanced_trading_dashboard.html" class="nav-link">Dashboard</a>
                <a href="trade_manager.html" class="nav-link">Trade Manager</a>
                <a href="prop_firms_v2.html" class="nav-link">Prop Portfolio</a>
                <a href="financial_summary.html" class="nav-link">Financial Summary</a>
                <a href="reporting_hub.html" class="nav-link">Reporting Hub</a>
                <a href="tradingview_integration.html" class="nav-link active">TradingView</a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="header">
            <h1>üìà TradingView Integration</h1>
            <p>Connect TradingView alerts to automatically populate trade data</p>
        </div>
        
        <div class="integration-grid">
            <div class="integration-card">
                <h3>üîó Webhook Configuration</h3>
                <p style="margin-bottom: 15px;">Use this URL in your TradingView alerts to send data directly to your dashboard</p>
                
                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                    <span class="status-indicator status-active"></span>
                    <span>Webhook Status: Active</span>
                </div>
                
                <div class="webhook-url" id="webhookUrl">
                    http://localhost:3000/webhook/tradingview
                </div>
                
                <button class="btn" onclick="copyWebhookUrl()">üìã Copy URL</button>
                <button class="btn btn-secondary" onclick="testWebhook()">üß™ Test Webhook</button>
                <button class="btn btn-secondary" onclick="generateNewUrl()">üîÑ Generate New URL</button>
            </div>
            
            <div class="integration-card">
                <h3>üìä Alert Statistics</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                    <div style="text-align: center;">
                        <div style="font-size: 2em; color: #00ff88;" id="alertCount">0</div>
                        <div style="opacity: 0.7;">Alerts Received</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2em; color: #00ff88;" id="tradesCreated">0</div>
                        <div style="opacity: 0.7;">Trades Created</div>
                    </div>
                </div>
                
                <button class="btn" onclick="viewAlertHistory()">üìã View History</button>
                <button class="btn btn-secondary" onclick="clearAlerts()">üóëÔ∏è Clear Alerts</button>
            </div>
        </div>
        
        <div class="integration-card" style="margin-bottom: 20px;">
            <h3>üìù Pine Script Template</h3>
            <p style="margin-bottom: 15px;">Copy this Pine Script code to send structured alerts to your dashboard</p>
            
            <div class="pine-script" id="pineScript">
//@version=5
strategy("Dashboard Integration", overlay=true)

// Your strategy logic here
// Example: Simple MA crossover
fast_ma = ta.sma(close, 10)
slow_ma = ta.sma(close, 20)

long_condition = ta.crossover(fast_ma, slow_ma)
short_condition = ta.crossunder(fast_ma, slow_ma)

// Calculate R-target based on ATR
atr = ta.atr(14)
r_target = input.float(2.0, "R Target", minval=0.5, maxval=5.0)

if long_condition
    strategy.entry("Long", strategy.long)
    // Send alert with structured data
    alert('{"action":"entry","direction":"long","symbol":"' + syminfo.ticker + '","price":' + str.tostring(close) + ',"rTarget":' + str.tostring(r_target) + ',"atr":' + str.tostring(atr) + ',"timestamp":"' + str.tostring(time) + '"}', alert.freq_once_per_bar)

if short_condition
    strategy.entry("Short", strategy.short)
    alert('{"action":"entry","direction":"short","symbol":"' + syminfo.ticker + '","price":' + str.tostring(close) + ',"rTarget":' + str.tostring(r_target) + ',"atr":' + str.tostring(atr) + ',"timestamp":"' + str.tostring(time) + '"}', alert.freq_once_per_bar)
            </div>
            
            <button class="btn" onclick="copyPineScript()">üìã Copy Pine Script</button>
            <button class="btn btn-secondary" onclick="downloadPineScript()">üíæ Download .pine</button>
        </div>
        
        <div class="integration-card">
            <h3>üì® Recent Alerts</h3>
            <div class="alert-log" id="alertLog">
                <div class="alert-item">
                    <strong>No alerts received yet</strong><br>
                    Configure your TradingView alerts to start receiving data
                </div>
            </div>
        </div>
        
        <div class="integration-card" style="margin-top: 20px;">
            <h3>‚öôÔ∏è Alert Configuration Guide</h3>
            <ol style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                <li>Copy the webhook URL above</li>
                <li>In TradingView, create a new alert</li>
                <li>Set "Webhook URL" to the copied URL</li>
                <li>Use the Pine Script template for structured data</li>
                <li>Test the connection using the "Test Webhook" button</li>
                <li>Alerts will automatically create trades in your dashboard</li>
            </ol>
            
            <div style="background: rgba(255,193,7,0.1); padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 3px solid #ffc107;">
                <strong>‚ö†Ô∏è Note:</strong> This is a development setup. For live trading, you'll need to deploy the webhook endpoint to a public server (Heroku, AWS, etc.)
            </div>
        </div>
    </div>

    <script>
        // Simulated webhook data storage
        let alertHistory = JSON.parse(localStorage.getItem('tvAlerts')) || [];
        let alertCount = alertHistory.length;
        let tradesCreated = alertHistory.filter(a => a.processed).length;
        
        // Update counters
        document.getElementById('alertCount').textContent = alertCount;
        document.getElementById('tradesCreated').textContent = tradesCreated;
        
        function copyWebhookUrl() {
            const url = document.getElementById('webhookUrl').textContent;
            navigator.clipboard.writeText(url);
            alert('‚úÖ Webhook URL copied to clipboard!');
        }
        
        function testWebhook() {
            // Simulate receiving a test alert
            const testAlert = {
                action: 'entry',
                direction: 'long',
                symbol: 'EURUSD',
                price: 1.0850,
                rTarget: 2.0,
                atr: 0.0015,
                timestamp: new Date().toISOString(),
                processed: true
            };
            
            alertHistory.unshift(testAlert);
            localStorage.setItem('tvAlerts', JSON.stringify(alertHistory));
            
            updateAlertLog();
            updateCounters();
            
            alert('‚úÖ Test webhook successful! Check the alert log below.');
        }
        
        function generateNewUrl() {
            const newUrl = `http://localhost:3000/webhook/tradingview?key=${Math.random().toString(36).substr(2, 9)}`;
            document.getElementById('webhookUrl').textContent = newUrl;
            alert('üîÑ New webhook URL generated for security');
        }
        
        function copyPineScript() {
            const script = document.getElementById('pineScript').textContent;
            navigator.clipboard.writeText(script);
            alert('üìã Pine Script copied to clipboard!');
        }
        
        function downloadPineScript() {
            const script = document.getElementById('pineScript').textContent;
            const blob = new Blob([script], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dashboard_integration.pine';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function viewAlertHistory() {
            if (alertHistory.length === 0) {
                alert('üì≠ No alerts received yet. Configure TradingView alerts to start receiving data.');
                return;
            }
            
            const history = alertHistory.slice(0, 10).map(alert => 
                `${new Date(alert.timestamp).toLocaleString()}: ${alert.action.toUpperCase()} ${alert.direction} ${alert.symbol} @ ${alert.price}`
            ).join('\\n');
            
            alert(`üìä Recent Alert History:\\n\\n${history}`);
        }
        
        function clearAlerts() {
            if (confirm('üóëÔ∏è Clear all alert history? This cannot be undone.')) {
                alertHistory = [];
                localStorage.setItem('tvAlerts', JSON.stringify(alertHistory));
                updateAlertLog();
                updateCounters();
                alert('‚úÖ Alert history cleared');
            }
        }
        
        function updateAlertLog() {
            const logElement = document.getElementById('alertLog');
            
            if (alertHistory.length === 0) {
                logElement.innerHTML = '<div class="alert-item"><strong>No alerts received yet</strong><br>Configure your TradingView alerts to start receiving data</div>';
                return;
            }
            
            const recentAlerts = alertHistory.slice(0, 5).map(alert => `
                <div class="alert-item">
                    <strong>${alert.action.toUpperCase()} ${alert.direction} ${alert.symbol}</strong><br>
                    Price: ${alert.price} | R-Target: ${alert.rTarget} | ${new Date(alert.timestamp).toLocaleString()}
                    ${alert.processed ? '<span style="color: #00ff88;"> ‚úÖ Processed</span>' : '<span style="color: #ffc107;"> ‚è≥ Pending</span>'}
                </div>
            `).join('');
            
            logElement.innerHTML = recentAlerts;
        }
        
        function updateCounters() {
            alertCount = alertHistory.length;
            tradesCreated = alertHistory.filter(a => a.processed).length;
            document.getElementById('alertCount').textContent = alertCount;
            document.getElementById('tradesCreated').textContent = tradesCreated;
        }
        
        // Initialize alert log
        updateAlertLog();
        
        // Simulate periodic webhook checks (in real implementation, this would be server-side)
        setInterval(() => {
            // This would normally check for new webhooks from the server
            // For demo purposes, we'll just update the display
        }, 5000);
    </script>
</body>
</html>