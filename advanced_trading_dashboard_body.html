<body>
    <nav class="navbar">
        <div style="display: flex; justify-content: space-between; align-items: center;">

            <div style="display: flex; gap: 15px; align-items: center; justify-content: center; flex: 1;">
                <select id="styleSelector" onchange="changeStyle()" class="theme-select">
                    <option value="slate">Slate</option>
                    <option value="charcoal">Charcoal</option>
                    <option value="navy">Navy</option>
                    <option value="graphite">Graphite</option>
                    <option value="midnight">Midnight</option>
                    <option value="steel">Steel</option>
                    <option value="carbon">Carbon</option>
                    <option value="obsidian">Obsidian</option>
                    <option value="onyx">Onyx</option>
                    <option value="platinum">Platinum</option>
                    <option value="arctic">Arctic</option>
                </select>
                <a class="active nav-link" data-route="dashboard" href="/dashboard">Dashboard</a>
                <a class="nav-link" data-route="trade-manager" href="/trade-manager">Trade Manager</a>
                <a class="nav-link" data-route="signal-analysis-lab" href="/signal-analysis-lab">Signal Lab</a>
                <a class="nav-link" data-route="prop-portfolio" href="/prop-portfolio">Prop Portfolio</a>
                <a class="nav-link" data-route="financial-summary" href="/financial-summary">Financial Summary</a>
                <a class="nav-link" data-route="reporting-hub" href="/reporting-hub">Reporting Hub</a>
                <a class="nav-link" data-route="tradingview" href="/tradingview">TradingView</a>
                <a class="nav-link" data-route="styles" href="/styles">Styles</a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="header">
            <h1>Analytics Dashboard</h1>
            <p>Dynamic Equity Curve with Session & R-Target Filtering</p>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                <div style="text-align: left;">
                    <div style="font-size: 14px; opacity: 0.8;">Current Time</div>
                    <div id="currentDateTime" style="font-size: 18px; font-weight: 600;">Loading...</div>
                </div>
                <div id="marketStatus" style="display: flex; gap: 15px;">Loading markets...</div>
            </div>
        </div>
        
        <!-- Real-Time News Ticker -->
        <div style="background: linear-gradient(135deg, rgba(0,123,255,0.1), rgba(0,86,179,0.1)); border: 1px solid rgba(0,123,255,0.2); border-radius: 15px; padding: 20px; margin-bottom: 25px; overflow: hidden;">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                <h3 style="color: #007bff; margin: 0; display: flex; align-items: center; gap: 10px;">
                    ðŸ“ˆ Live Market Feed
                    <span style="font-size: 12px; background: rgba(0,123,255,0.2); padding: 2px 8px; border-radius: 10px; font-weight: normal;">Real-Time</span>
                </h3>
                <div id="futuresData" style="display: flex; gap: 15px; font-size: 12px; font-weight: 600;">Loading futures...</div>
            </div>
            <div id="newsTicker" style="background: rgba(0,0,0,0.2); border-radius: 8px; padding: 10px; height: 60px; overflow: hidden; position: relative;">
                <div id="tickerContent" style="white-space: nowrap; animation: scroll 60s linear infinite; color: rgba(255,255,255,0.9); font-size: 14px; line-height: 1.4;">
                    Loading market news...
                </div>
            </div>
        </div>
        
        <!-- AI Market Intelligence -->
        <div style="background: linear-gradient(135deg, rgba(255,165,0,0.1), rgba(255,140,0,0.1)); border: 1px solid rgba(255,165,0,0.3); border-radius: 15px; padding: 20px; margin-bottom: 25px;">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                <h3 style="color: #ffa500; margin: 0; display: flex; align-items: center; gap: 10px;">
                    ðŸ¤– AI Market Intelligence
                    <span style="font-size: 12px; background: rgba(255,165,0,0.2); padding: 2px 8px; border-radius: 10px; font-weight: normal;">GPT-4o Powered</span>
                </h3>
                <div id="marketBias" style="font-size: 14px; font-weight: 600; padding: 4px 12px; border-radius: 6px; background: rgba(255,255,255,0.1);">ANALYZING...</div>
            </div>
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                <div>
                    <div id="aiMarketAnalysis" style="font-size: 13px; line-height: 1.5; margin-bottom: 15px; color: rgba(255,255,255,0.9); background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; min-height: 80px;">
                        <div class="ai-loading">ðŸ”„ ICT AI analyzing 1H bias, session structure, and FVG opportunities...</div>
                    </div>
                    <div id="marketAlerts" style="font-size: 12px; background: rgba(255,71,87,0.1); border: 1px solid rgba(255,71,87,0.3); border-radius: 6px; padding: 10px; min-height: 40px;">
                        <strong>Setup Alerts:</strong> <span id="alertsList">Monitoring for pivot sweeps and FVG formations...</span>
                    </div>
                </div>
                <div>
                    <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 15px;">
                        <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px; font-weight: 600;">NQ KEY LEVELS</div>
                        <div id="keyLevels" style="font-size: 13px; line-height: 1.4;">
                            <div><strong>Resistance:</strong> <span id="resistanceLevels">Loading...</span></div>
                            <div><strong>Support:</strong> <span id="supportLevels">Loading...</span></div>
                            <div><strong>Pivot:</strong> <span id="pivotLevel">Loading...</span></div>
                        </div>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <div style="font-size: 11px; opacity: 0.8;">AI CONFIDENCE</div>
                            <div id="aiConfidence" style="font-size: 16px; font-weight: 600; color: #00ff88;">75%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Economic News & AI Analysis -->
        <div style="background: linear-gradient(135deg, rgba(138,43,226,0.1), rgba(75,0,130,0.1)); border: 1px solid rgba(138,43,226,0.3); border-radius: 15px; padding: 20px; margin-bottom: 25px;">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                <h3 style="color: #8a2be2; margin: 0; display: flex; align-items: center; gap: 10px;">
                    ðŸ“Š Economic Intelligence
                    <span style="font-size: 12px; background: rgba(138,43,226,0.2); padding: 2px 8px; border-radius: 10px; font-weight: normal;">AI Powered</span>
                </h3>
                <div id="economicImpact" style="font-size: 14px; font-weight: 600; padding: 4px 12px; border-radius: 6px; background: rgba(255,255,255,0.1);">NEUTRAL</div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px; font-weight: 600;">TODAY'S ECONOMIC EVENTS</div>
                    <div id="economicEvents" style="font-size: 12px; line-height: 1.4; margin-bottom: 15px; background: rgba(0,0,0,0.2); padding: 12px; border-radius: 6px; min-height: 60px;">
                        <div class="ai-loading">Loading economic calendar...</div>
                    </div>
                </div>
                <div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px; font-weight: 600;">AI ECONOMIC ANALYSIS</div>
                    <div id="aiEconomicAnalysis" style="font-size: 12px; line-height: 1.4; background: rgba(0,0,0,0.2); padding: 12px; border-radius: 6px; min-height: 60px;">
                        <div class="ai-loading">Analyzing economic impact on NQ futures...</div>
                    </div>
                </div>
            </div>
            <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                <div style="font-size: 11px; opacity: 0.8; margin-bottom: 5px; font-weight: 600;">KEY ECONOMIC RISKS</div>
                <div id="economicRisks" style="font-size: 12px; line-height: 1.3;">Monitoring Fed policy, inflation data, and employment trends...</div>
            </div>
        </div>
        
        <!-- Strategy Overview Panel -->
        <div style="background: linear-gradient(135deg, rgba(0,255,136,0.1), rgba(0,212,170,0.1)); border: 1px solid rgba(0,255,136,0.2); border-radius: 15px; padding: 20px; margin-bottom: 25px;">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                <h3 style="color: #00ff88; margin: 0; display: flex; align-items: center; gap: 10px;">
                    ðŸŽ¯ ICT Liquidity Grab Strategy
                    <span style="font-size: 12px; background: rgba(0,255,136,0.2); padding: 2px 8px; border-radius: 10px; font-weight: normal;">Active System</span>
                </h3>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 15px;">
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px; font-weight: 600;">BIAS DETERMINATION</div>
                    <div style="font-size: 13px; line-height: 1.4;">
                        â€¢ <strong>1H FVG/IFVG</strong> respect/violation<br>
                        â€¢ Color-coded bias indicator<br>
                        â€¢ Session structure confirmation
                    </div>
                </div>
                <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 15px;">
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px; font-weight: 600;">ENTRY CRITERIA</div>
                    <div style="font-size: 13px; line-height: 1.4;">
                        â€¢ <strong>1min pivot sweep</strong> completion<br>
                        â€¢ <strong>FVG/IFVG formation</strong> confirmation<br>
                        â€¢ Entry at gap top/bottom
                    </div>
                </div>
                <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 15px;">
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px; font-weight: 600;">RISK MANAGEMENT</div>
                    <div style="font-size: 13px; line-height: 1.4;">
                        â€¢ <strong>SL:</strong> Below/above FVG base<br>
                        â€¢ <strong>BE:</strong> 1:1 risk/reward<br>
                        â€¢ <strong>TP:</strong> Testing R-targets
                    </div>
                </div>
            </div>
            <div style="margin-top: 15px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; border-left: 3px solid #00ff88;">
                <div style="font-size: 12px; opacity: 0.8; margin-bottom: 5px;">STRATEGY NOTES</div>
                <div style="font-size: 13px; font-weight: 500;">High-frequency NQ scalping using ICT concepts. Multiple setups per session targeting liquidity grabs with precise FVG-based entries and tight risk management.</div>
            </div>
        </div>
        
        <div class="controls" style="margin-bottom: 20px;">
            <div style="background: linear-gradient(135deg, rgba(0,255,136,0.1), rgba(0,212,170,0.1)); border: 1px solid rgba(0,255,136,0.2); border-radius: 15px; padding: 20px; margin-bottom: 25px;">
                <h3 style="color: #00ff88; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    AI Strategy Intelligence
                    <span style="font-size: 12px; background: rgba(0,255,136,0.2); padding: 2px 8px; border-radius: 10px; font-weight: normal;">Live Analysis</span>
                </h3>
                <div id="strategySummary" style="font-size: 14px; line-height: 1.6; margin-bottom: 15px; color: rgba(255,255,255,0.9);">Initializing comprehensive strategy analysis...</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 15px;">
                    <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 11px; opacity: 0.8; margin-bottom: 5px;">SYSTEM HEALTH</div>
                        <div id="systemHealth" style="font-size: 16px; font-weight: 600; color: #00ff88;">Analyzing...</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 11px; opacity: 0.8; margin-bottom: 5px;">ADAPTATION SCORE</div>
                        <div id="adaptationScore" style="font-size: 16px; font-weight: 600; color: #ffa502;">Learning...</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 11px; opacity: 0.8; margin-bottom: 5px;">NEXT ACTION</div>
                        <div id="nextAction" style="font-size: 16px; font-weight: 600; color: #3742fa;">Processing...</div>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; border-left: 3px solid #00ff88;">
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 5px;">STRATEGIC RECOMMENDATION</div>
                    <div id="strategicRecommendation" style="font-size: 13px; font-weight: 500;">Analyzing your trading patterns and market conditions...</div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <div class="filter-group">
                <label>Session Filter</label>
                <div class="session-checkboxes">
                    <label><input type="checkbox" id="sessionAll" checked onchange="toggleAllSessions()"> All</label>
                    <label><input type="checkbox" class="session-filter" value="ASIA" onchange="updateCharts()"> Asia</label>
                    <label><input type="checkbox" class="session-filter" value="LONDON" onchange="updateCharts()"> London</label>
                    <label><input type="checkbox" class="session-filter" value="NY PRE MARKET" onchange="updateCharts()"> NY Pre</label>
                    <label><input type="checkbox" class="session-filter" value="NEW YORK AM" onchange="updateCharts()"> NY AM</label>
                    <label><input type="checkbox" class="session-filter" value="NY LUNCH" onchange="updateCharts()"> NY Lunch</label>
                    <label><input type="checkbox" class="session-filter" value="NEW YORK PM" onchange="updateCharts()"> NY PM</label>
                </div>
            </div>
            
            <div class="filter-group">
                <label>R Target</label>
                <select id="rTargetFilter" onchange="updateCharts()">
                    <option value="1">1R Target</option>
                    <option value="2">2R Target</option>
                    <option value="3">3R Target</option>
                    <option value="4">4R Target</option>
                    <option value="5">5R Target</option>
                    <option value="6">6R Target</option>
                    <option value="7">7R Target</option>
                    <option value="8">8R Target</option>
                    <option value="9">9R Target</option>
                    <option value="10">10R Target</option>
                    <option value="11">11R Target</option>
                    <option value="12">12R Target</option>
                    <option value="13">13R Target</option>
                    <option value="14">14R Target</option>
                    <option value="15">15R Target</option>
                    <option value="16">16R Target</option>
                    <option value="17">17R Target</option>
                    <option value="18">18R Target</option>
                    <option value="19">19R Target</option>
                    <option value="20">20R Target</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Bias Filter</label>
                <select id="biasFilter" onchange="updateCharts()">
                    <option value="ALL">All Bias</option>
                    <option value="LONG">Long</option>
                    <option value="SHORT">Short</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Include Breakeven</label>
                <select id="breakevenFilter" onchange="updateCharts()">
                    <option value="true">Include BE</option>
                    <option value="false">Exclude BE</option>
                </select>
            </div>
        </div>
        
        <div class="metrics-grid">
            <div class="metric-card tooltip" data-tooltip="Total number of trades in your dataset. More trades = more reliable statistics.">
                <div class="metric-label">Total Trades</div>
                <div class="metric-value" id="filteredTrades">0</div>
            </div>
            <div class="metric-card tooltip" data-tooltip="Percentage of winning trades. Good: >50%, Excellent: >60%. Includes breakeven trades as wins.">
                <div class="metric-label">Win Rate</div>
                <div class="metric-value positive" id="filteredWinRate">0%</div>
            </div>
            <div class="metric-card tooltip" data-tooltip="Gross profit Ã· gross loss. Good: >1.25, Excellent: >2.0. Measures how much you make vs lose.">
                <div class="metric-label">Profit Factor</div>
                <div class="metric-value" id="profitFactor">0.00</div>
            </div>
            <div class="metric-card tooltip" data-tooltip="Average R per trade. Positive = profitable system. Good: >0.2R, Excellent: >0.5R.">
                <div class="metric-label">Expectancy</div>
                <div class="metric-value" id="expectancy">0.00R</div>
            </div>
            <div class="metric-card tooltip" data-tooltip="Risk-adjusted return. Good: >1.0, Excellent: >2.0. Higher = better return per unit of risk.">
                <div class="metric-label">Sharpe Ratio</div>
                <div class="metric-value" id="sharpeRatio">0.00</div>
            </div>
            <div class="metric-card tooltip" data-tooltip="Largest peak-to-trough loss. Lower is better. Good: <10R, Acceptable: <20R.">
                <div class="metric-label">Max Drawdown</div>
                <div class="metric-value negative" id="maxDrawdown">0.00R</div>
            </div>
            <div class="metric-card tooltip" data-tooltip="Total return Ã· max drawdown. Good: >2.0, Excellent: >5.0. Measures profit vs worst loss.">
                <div class="metric-label">Recovery Factor</div>
                <div class="metric-value" id="recoveryFactor">0.00</div>
            </div>
            <div class="metric-card tooltip" data-tooltip="Optimal position size based on win rate and avg win/loss. Good: 10-25%, Dangerous: >50%.">
                <div class="metric-label">Kelly %</div>
                <div class="metric-value" id="kellyPercent">0.00%</div>
            </div>
        </div>