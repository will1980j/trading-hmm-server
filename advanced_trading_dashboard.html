<!DOCTYPE html>
<html lang="en">
<head>
<style id="chat-hotfix">
  /* Chat hotfix: ensure the chat is clickable and on top */
  #aiChatWidget, #aiChatWidget * { pointer-events: auto; }
  #aiChatWidget .chat-container { z-index: 2147483647 !important; }
  #aiChatWidget .chat-toggle { z-index: 2147483646 !important; }
  #chatInput { pointer-events: auto !important; }
</style>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Trading Analytics</title>
    <link rel="stylesheet" href="/style_preload.css">

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/d3-selection.v3.min.js"></script>
    <script src="https://d3js.org/d3-scale.v4.min.js"></script>
    <script src="https://d3js.org/d3-axis.v3.min.js"></script>
    <script src="https://d3js.org/d3-shape.v3.min.js"></script>
    <script src="https://d3js.org/d3-zoom.v3.min.js"></script>
    <script src="https://d3js.org/d3-brush.v3.min.js"></script>
    <script src="https://d3js.org/d3-transition.v3.min.js"></script>
    <script src="d3_charts.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js" crossorigin="anonymous"></script>
    <script defer src="api_integration.js"></script>
    <script defer src="notification_system.js"></script>
    <script defer src="professional_styles.js"></script>
    <script defer src="ai_chat.js"></script>
    <script src="dashboard_fixes.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --accent-color: #00ff88;
            --glass-bg: rgba(255,255,255,0.08);
            --glass-border: rgba(255,255,255,0.1);
            --shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            margin: 0;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        /* Theme Styles */
        .theme-gradient {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
        }
        
        .theme-dark {
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
            color: #e0e0e0;
        }
        
        .theme-minimal {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #212529;
        }
        
        .theme-minimal .navbar {
            background: rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .theme-minimal .nav-link {
            color: #495057;
            background: rgba(0,0,0,0.03);
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .theme-minimal .nav-link:hover {
            background: rgba(0,0,0,0.08);
            color: #212529;
        }
        
        .theme-minimal .nav-link.active {
            color: #007bff;
            background: rgba(0,123,255,0.1);
            border-color: rgba(0,123,255,0.2);
        }
        
        .theme-minimal .header,
        .theme-minimal .controls,
        .theme-minimal .metric-card,
        .theme-minimal .chart-container,
        .theme-minimal .calendar-day {
            background: rgba(255,255,255,0.8);
            border: 1px solid rgba(0,0,0,0.1);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            color: #212529;
        }
        
        .theme-minimal .chart-container h3,
        .theme-minimal .metric-label,
        .theme-minimal .calendar-date,
        .theme-minimal .calendar-stats,
        .theme-minimal .filter-group label {
            color: #495057;
        }
        
        .theme-minimal .positive { color: #28a745; }
        .theme-minimal .negative { color: #dc3545; }
        .theme-minimal .neutral { color: #ffc107; }
        
        .market-widget {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.08);
            border-radius: 8px;
            min-width: 100px;
            transition: all 0.3s ease;
        }
        
        .market-widget:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .market-name {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .market-status {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-bottom: 5px;
        }
        
        .market-open {
            background: rgba(0,255,136,0.2);
            color: #00ff88;
        }
        
        .market-closed {
            background: rgba(255,71,87,0.2);
            color: #ff4757;
        }
        
        .market-timer {
            font-size: 11px;
            font-weight: 500;
            opacity: 0.9;
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px rgba(0,255,136,0.3); }
            50% { box-shadow: 0 0 25px rgba(0,255,136,0.8); }
        }
        
        .market-widget.open {
            animation: glow 2s infinite;
            border: 1px solid rgba(0,255,136,0.3);
        }
        
        .market-status.market-open {
            animation: pulse 2s infinite;
        }
        
        .theme-minimal .theme-select {
            background: rgba(255,255,255,0.9);
            color: #495057;
            border: 1px solid rgba(0,0,0,0.2);
        }
        
        .theme-neon {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 100%);
            color: #00ff88;
        }
        
        .theme-gold {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2416 100%);
            color: #f4e4bc;
        }
        
        .navbar {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 15px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .nav-link {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            padding: 10px 18px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .nav-link:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .nav-link.active {
            color: #00ff88;
            background: rgba(0,255,136,0.15);
            border-color: rgba(0,255,136,0.3);
        }
        
        .theme-select {
            padding: 8px 12px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }
        
        .theme-select option {
            background: #2a2a2a;
            color: white;
        }
        
        .theme-minimal .theme-select {
            background: rgba(255,255,255,0.9);
            color: #495057;
            border: 1px solid rgba(0,0,0,0.2);
        }
        
        .theme-minimal .theme-select option {
            background: white;
            color: #495057;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            padding: 30px;
            background: rgba(255,255,255,0.08);
            border-radius: 20px;
            backdrop-filter: blur(20px);
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00ff88, #00d4aa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .theme-minimal .header h1 {
            background: linear-gradient(45deg, #007bff, #0056b3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .controls {
            display: flex;
            gap: 25px;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.08);
            padding: 25px;
            border-radius: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .session-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .session-checkboxes label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            white-space: nowrap;
        }
        
        .session-checkboxes input[type="checkbox"] {
            width: auto;
            padding: 0;
        }
        
        .filter-group label {
            font-size: 12px;
            opacity: 0.8;
            text-transform: uppercase;
        }
        
        select, input {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 14px;
        }
        
        select option {
            background: white;
            color: #333;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .chart-container {
            background: rgba(255,255,255,0.08);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            height: auto;
            min-height: 480px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .chart-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }
        
        .chart-container h3 {
            font-weight: 600;
            margin-bottom: 15px;
            color: rgba(255,255,255,0.9);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .advanced-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .metric-section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .ai-insight {
            background: linear-gradient(45deg, rgba(0,255,136,0.1), rgba(0,212,170,0.1));
            border: 1px solid rgba(0,255,136,0.2);
            border-radius: 8px;
            padding: 10px;
            margin: 5px 0;
            font-size: 12px;
        }
        
        .loading {
            opacity: 0.6;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        .metric-section h3 {
            margin-bottom: 15px;
            color: #00ff88;
        }
        
        .risk-metrics, .monte-carlo {
            display: grid;
            gap: 10px;
        }
        
        .risk-item, .mc-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .metric-card {
            background: rgba(255,255,255,0.08);
            border-radius: 18px;
            padding: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            background: rgba(255,255,255,0.12);
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: 700;
            margin: 10px 0;
            background: linear-gradient(45deg, var(--accent-color), #00d4aa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .theme-minimal .metric-value {
            background: linear-gradient(45deg, #007bff, #0056b3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .metric-label {
            font-size: 0.8em;
            opacity: 0.8;
            text-transform: uppercase;
        }
        
        .positive { color: #00ff88; }
        .negative { color: #ff4757; }
        .neutral { color: #ffa502; }
        
        .data-input {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }
        
        .input-labels {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            margin-bottom: 5px;
        }
        
        .input-labels span {
            font-size: 12px;
            opacity: 0.8;
            text-align: center;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            margin: 5px 0 15px 0;
        }
        
        .btn {
            background: linear-gradient(45deg, var(--accent-color), #00d4aa);
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(0,255,136,0.2);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,255,136,0.4);
            background: linear-gradient(45deg, #00d4aa, var(--accent-color));
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .trades-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .trades-table th,
        .trades-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .trades-table th {
            background: rgba(255,255,255,0.1);
            font-weight: bold;
        }
        
        .r-columns {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            font-size: 12px;
        }
        
        .r-value {
            padding: 2px 5px;
            border-radius: 3px;
            text-align: center;
        }
        
        /* Modern Calendar Heatmap Styles */
        .calendar-heatmap {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .calendar-months {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .calendar-month {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .calendar-month-label {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255,255,255,0.8);
            margin-bottom: 5px;
        }
        
        .calendar-weeks {
            display: flex;
            gap: 3px;
        }
        
        .calendar-week {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .calendar-day-heatmap {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .calendar-day-heatmap:hover {
            transform: scale(1.3);
            border: 1px solid rgba(255,255,255,0.4);
            z-index: 10;
            position: relative;
        }
        
        .calendar-day-heatmap.no-data {
            background: rgba(255,255,255,0.05);
        }
        
        .calendar-day-heatmap.profit-1 { background: rgba(0, 255, 136, 0.2); }
        .calendar-day-heatmap.profit-2 { background: rgba(0, 255, 136, 0.4); }
        .calendar-day-heatmap.profit-3 { background: rgba(0, 255, 136, 0.6); }
        .calendar-day-heatmap.profit-4 { background: rgba(0, 255, 136, 0.8); }
        .calendar-day-heatmap.profit-5 { background: rgba(0, 255, 136, 1.0); }
        
        .calendar-day-heatmap.loss-1 { background: rgba(255, 71, 87, 0.2); }
        .calendar-day-heatmap.loss-2 { background: rgba(255, 71, 87, 0.4); }
        .calendar-day-heatmap.loss-3 { background: rgba(255, 71, 87, 0.6); }
        .calendar-day-heatmap.loss-4 { background: rgba(255, 71, 87, 0.8); }
        .calendar-day-heatmap.loss-5 { background: rgba(255, 71, 87, 1.0); }
        
        .calendar-day-heatmap.breakeven { background: rgba(255, 165, 2, 0.5); }
        
        .calendar-legend {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: rgba(255,255,255,0.7);
        }
        
        .calendar-legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .calendar-legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        /* Traditional Calendar Styles */
        .calendar-day {
            background: var(--glass-bg);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            font-size: 12px;
            min-height: 85px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }
        
        .calendar-day:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }
        
        .calendar-profitable { background: rgba(0, 255, 136, 0.3); }
        .calendar-loss { background: rgba(255, 71, 87, 0.3); }
        .calendar-breakeven { background: rgba(255, 165, 2, 0.3); }
        
        .calendar-date { font-weight: bold; margin-bottom: 4px; }
        .calendar-stats { font-size: 10px; opacity: 0.9; }
        
        /* Calendar Tooltip */
        .calendar-tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            pointer-events: none;
            z-index: 1000;
            max-width: 200px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .tooltip {
            position: relative;
            cursor: help;
        }
        
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            z-index: 1000;
            max-width: 300px;
            white-space: normal;
            width: max-content;
        }
        
        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        /* News Ticker Animation */
        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        /* Market Data Styling */
        .positive { color: #00ff88; }
        .negative { color: #ff4757; }
        .neutral { color: #ffa502; }
        
        .bias-long { background: rgba(0,255,136,0.2) !important; color: #00ff88; }
        .bias-short { background: rgba(255,71,87,0.2) !important; color: #ff4757; }
        .bias-neutral { background: rgba(255,165,0,0.2) !important; color: #ffa502; }
        
        /* AI Analysis Formatting */
        .ai-analysis-formatted {
            font-family: 'Inter', sans-serif;
        }
        
        .ai-loading {
            opacity: 0.7;
            font-style: italic;
        }

        /* Chat Widget Styles */
        .chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .chat-toggle {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }

        .chat-toggle:hover {
            transform: scale(1.1);
        }

        .chat-toggle i {
            color: white;
            font-size: 24px;
        }

        .chat-container {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 25px;
            height: 25px;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .chat-message {
            margin-bottom: 15px;
        }

        .chat-message.user .message-content {
            background: #667eea;
            color: white;
            padding: 10px 15px;
            border-radius: 18px 18px 5px 18px;
            margin-left: 50px;
            word-wrap: break-word;
        }

        .chat-message.ai .message-content {
            background: white;
            color: #333;
            padding: 10px 15px;
            border-radius: 18px 18px 18px 5px;
            margin-right: 50px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            word-wrap: break-word;
        }

        .chat-input {
            padding: 15px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
        }

        .chat-input button {
            width: 40px;
            height: 40px;
            background: #667eea;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-input button:hover {
            background: #5a6fd8;
        }
    </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" referrerpolicy="no-referrer"/>
</head>
<body>
    <nav class="navbar">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; gap: 15px; align-items: center; justify-content: center; flex: 1;">
                <select id="styleSelector" onchange="changeStyle()" class="theme-select">
                    <option value="slate">Slate</option>
                    <option value="charcoal">Charcoal</option>
                    <option value="navy">Navy</option>
                    <option value="graphite">Graphite</option>
                    <option value="midnight">Midnight</option>
                    <option value="steel">Steel</option>
                    <option value="carbon">Carbon</option>
                    <option value="obsidian">Obsidian</option>
                    <option value="onyx">Onyx</option>
                    <option value="platinum">Platinum</option>
                    <option value="arctic">Arctic</option>
                </select>
                <a class="active nav-link" data-route="dashboard" href="/dashboard">Dashboard</a>
                <a class="nav-link" data-route="trade-manager" href="/trade-manager">Trade Manager</a>
                <a class="nav-link" data-route="signal-analysis-lab" href="/signal-analysis-lab">Signal Lab</a>
                <a class="nav-link" data-route="prop-portfolio" href="/prop-portfolio">Prop Portfolio</a>
                <a class="nav-link" data-route="financial-summary" href="/financial-summary">Financial Summary</a>
                <a class="nav-link" data-route="reporting-hub" href="/reporting-hub">Reporting Hub</a>
                <a class="nav-link" data-route="tradingview" href="/tradingview">TradingView</a>
                <a class="nav-link" data-route="styles" href="/styles">Styles</a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="header">
            <h1>Analytics Dashboard</h1>
            <p>Dynamic Equity Curve with Session & R-Target Filtering</p>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                <div style="text-align: left;">
                    <div style="font-size: 14px; opacity: 0.8;">Current Time</div>
                    <div id="currentDateTime" style="font-size: 18px; font-weight: 600;">Loading...</div>
                </div>
                <div id="marketStatus" style="display: flex; gap: 15px;">Loading markets...</div>
            </div>
        </div>
        
        <!-- Real-Time News Ticker -->
        <div style="background: linear-gradient(135deg, rgba(0,123,255,0.1), rgba(0,86,179,0.1)); border: 1px solid rgba(0,123,255,0.2); border-radius: 15px; padding: 20px; margin-bottom: 25px; overflow: hidden;">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                <h3 style="color: #007bff; margin: 0; display: flex; align-items: center; gap: 10px;">
                    📈 Live Market Feed
                    <span style="font-size: 12px; background: rgba(0,123,255,0.2); padding: 2px 8px; border-radius: 10px; font-weight: normal;">Real-Time</span>
                </h3>
                <div id="futuresData" style="display: flex; gap: 15px; font-size: 12px; font-weight: 600;">Loading futures...</div>
            </div>
            <div id="newsTicker" style="background: rgba(0,0,0,0.2); border-radius: 8px; padding: 10px; height: 60px; overflow: hidden; position: relative;">
                <div id="tickerContent" style="white-space: nowrap; animation: scroll 60s linear infinite; color: rgba(255,255,255,0.9); font-size: 14px; line-height: 1.4;">
                    Loading market news...
                </div>
            </div>
        </div>
        
        <!-- AI Market Intelligence -->
        <div style="background: linear-gradient(135deg, rgba(255,165,0,0.1), rgba(255,140,0,0.1)); border: 1px solid rgba(255,165,0,0.3); border-radius: 15px; padding: 20px; margin-bottom: 25px;">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                <h3 style="color: #ffa500; margin: 0; display: flex; align-items: center; gap: 10px;">
                    🤖 AI Market Intelligence
                    <span style="font-size: 12px; background: rgba(255,165,0,0.2); padding: 2px 8px; border-radius: 10px; font-weight: normal;">GPT-4o Powered</span>
                </h3>
                <div id="marketBias" style="font-size: 14px; font-weight: 600; padding: 4px 12px; border-radius: 6px; background: rgba(255,255,255,0.1);">ANALYZING...</div>
            </div>
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                <div>
                    <div id="aiMarketAnalysis" style="font-size: 13px; line-height: 1.5; margin-bottom: 15px; color: rgba(255,255,255,0.9); background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; min-height: 80px;">
                        <div class="ai-loading">🔄 ICT AI analyzing 1H bias, session structure, and FVG opportunities...</div>
                    </div>
                    <div id="marketAlerts" style="font-size: 12px; background: rgba(255,71,87,0.1); border: 1px solid rgba(255,71,87,0.3); border-radius: 6px; padding: 10px; min-height: 40px;">
                        <strong>Setup Alerts:</strong> <span id="alertsList">Monitoring for pivot sweeps and FVG formations...</span>
                    </div>
                </div>
                <div>
                    <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 15px;">
                        <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px; font-weight: 600;">NQ KEY LEVELS</div>
                        <div id="keyLevels" style="font-size: 13px; line-height: 1.4;">
                            <div><strong>Resistance:</strong> <span id="resistanceLevels">Loading...</span></div>
                            <div><strong>Support:</strong> <span id="supportLevels">Loading...</span></div>
                            <div><strong>Pivot:</strong> <span id="pivotLevel">Loading...</span></div>
                        </div>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <div style="font-size: 11px; opacity: 0.8;">AI CONFIDENCE</div>
                            <div id="aiConfidence" style="font-size: 16px; font-weight: 600; color: #00ff88;">75%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Economic News & AI Analysis -->
        <div style="background: linear-gradient(135deg, rgba(138,43,226,0.1), rgba(75,0,130,0.1)); border: 1px solid rgba(138,43,226,0.3); border-radius: 15px; padding: 20px; margin-bottom: 25px;">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                <h3 style="color: #8a2be2; margin: 0; display: flex; align-items: center; gap: 10px;">
                    📊 Economic Intelligence
                    <span style="font-size: 12px; background: rgba(138,43,226,0.2); padding: 2px 8px; border-radius: 10px; font-weight: normal;">AI Powered</span>
                </h3>
                <div id="economicImpact" style="font-size: 14px; font-weight: 600; padding: 4px 12px; border-radius: 6px; background: rgba(255,255,255,0.1);">NEUTRAL</div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px; font-weight: 600;">TODAY'S ECONOMIC EVENTS</div>
                    <div id="economicEvents" style="font-size: 12px; line-height: 1.4; margin-bottom: 15px; background: rgba(0,0,0,0.2); padding: 12px; border-radius: 6px; min-height: 60px;">
                        <div class="ai-loading">Loading economic calendar...</div>
                    </div>
                </div>
                <div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px; font-weight: 600;">AI ECONOMIC ANALYSIS</div>
                    <div id="aiEconomicAnalysis" style="font-size: 12px; line-height: 1.4; background: rgba(0,0,0,0.2); padding: 12px; border-radius: 6px; min-height: 60px;">
                        <div class="ai-loading">Analyzing economic impact on NQ futures...</div>
                    </div>
                </div>
            </div>
            <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                <div style="font-size: 11px; opacity: 0.8; margin-bottom: 5px; font-weight: 600;">KEY ECONOMIC RISKS</div>
                <div id="economicRisks" style="font-size: 12px; line-height: 1.3;">Monitoring Fed policy, inflation data, and employment trends...</div>
            </div>
        </div>
        
        <!-- Strategy Overview Panel -->
        <div style="background: linear-gradient(135deg, rgba(0,255,136,0.1), rgba(0,212,170,0.1)); border: 1px solid rgba(0,255,136,0.2); border-radius: 15px; padding: 20px; margin-bottom: 25px;">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                <h3 style="color: #00ff88; margin: 0; display: flex; align-items: center; gap: 10px;">
                    🎯 ICT Liquidity Grab Strategy
                    <span style="font-size: 12px; background: rgba(0,255,136,0.2); padding: 2px 8px; border-radius: 10px; font-weight: normal;">Active System</span>
                </h3>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 15px;">
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px; font-weight: 600;">BIAS DETERMINATION</div>
                    <div style="font-size: 13px; line-height: 1.4;">
                        • <strong>1H FVG/IFVG</strong> respect/violation<br>
                        • Color-coded bias indicator<br>
                        • Session structure confirmation
                    </div>
                </div>
                <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 15px;">
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px; font-weight: 600;">ENTRY CRITERIA</div>
                    <div style="font-size: 13px; line-height: 1.4;">
                        • <strong>1min pivot sweep</strong> completion<br>
                        • <strong>FVG/IFVG formation</strong> confirmation<br>
                        • Entry at gap top/bottom
                    </div>
                </div>
                <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 15px;">
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px; font-weight: 600;">RISK MANAGEMENT</div>
                    <div style="font-size: 13px; line-height: 1.4;">
                        • <strong>SL:</strong> Below/above FVG base<br>
                        • <strong>BE:</strong> 1:1 risk/reward<br>
                        • <strong>TP:</strong> Testing R-targets
                    </div>
                </div>
            </div>
            <div style="margin-top: 15px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; border-left: 3px solid #00ff88;">
                <div style="font-size: 12px; opacity: 0.8; margin-bottom: 5px;">STRATEGY NOTES</div>
                <div style="font-size: 13px; font-weight: 500;">High-frequency NQ scalping using ICT concepts. Multiple setups per session targeting liquidity grabs with precise FVG-based entries and tight risk management.</div>
            </div>
        </div>
        
        <div class="controls" style="margin-bottom: 20px;">
            <div style="background: linear-gradient(135deg, rgba(0,255,136,0.1), rgba(0,212,170,0.1)); border: 1px solid rgba(0,255,136,0.2); border-radius: 15px; padding: 20px; margin-bottom: 25px;">
                <h3 style="color: #00ff88; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    AI Strategy Intelligence
                    <span style="font-size: 12px; background: rgba(0,255,136,0.2); padding: 2px 8px; border-radius: 10px; font-weight: normal;">Live Analysis</span>
                </h3>
                <div id="strategySummary" style="font-size: 14px; line-height: 1.6; margin-bottom: 15px; color: rgba(255,255,255,0.9);">Initializing comprehensive strategy analysis...</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 15px;">
                    <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 11px; opacity: 0.8; margin-bottom: 5px;">SYSTEM HEALTH</div>
                        <div id="systemHealth" style="font-size: 16px; font-weight: 600; color: #00ff88;">Analyzing...</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 11px; opacity: 0.8; margin-bottom: 5px;">ADAPTATION SCORE</div>
                        <div id="adaptationScore" style="font-size: 16px; font-weight: 600; color: #ffa502;">Learning...</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 11px; opacity: 0.8; margin-bottom: 5px;">NEXT ACTION</div>
                        <div id="nextAction" style="font-size: 16px; font-weight: 600; color: #3742fa;">Processing...</div>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; border-left: 3px solid #00ff88;">
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 5px;">STRATEGIC RECOMMENDATION</div>
                    <div id="strategicRecommendation" style="font-size: 13px; font-weight: 500;">Analyzing your trading patterns and market conditions...</div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <div class="filter-group">
                <label>Session Filter</label>
                <div class="session-checkboxes">
                    <label><input type="checkbox" id="sessionAll" checked onchange="toggleAllSessions()"> All</label>
                    <label><input type="checkbox" class="session-filter" value="ASIA" onchange="updateCharts()"> Asia</label>
                    <label><input type="checkbox" class="session-filter" value="LONDON" onchange="updateCharts()"> London</label>
                    <label><input type="checkbox" class="session-filter" value="NY PRE MARKET" onchange="updateCharts()"> NY Pre</label>
                    <label><input type="checkbox" class="session-filter" value="NEW YORK AM" onchange="updateCharts()"> NY AM</label>
                    <label><input type="checkbox" class="session-filter" value="NY LUNCH" onchange="updateCharts()"> NY Lunch</label>
                    <label><input type="checkbox" class="session-filter" value="NEW YORK PM" onchange="updateCharts()"> NY PM</label>
                </div>
            </div>
            
            <div class="filter-group">
                <label>R Target</label>
                <select id="rTargetFilter" onchange="updateCharts()">
                    <option value="1">1R Target</option>
                    <option value="2">2R Target</option>
                    <option value="3">3R Target</option>
                    <option value="4">4R Target</option>
                    <option value="5">5R Target</option>
                    <option value="6">6R Target</option>
                    <option value="7">7R Target</option>
                    <option value="8">8R Target</option>
                    <option value="9">9R Target</option>
                    <option value="10">10R Target</option>
                    <option value="11">11R Target</option>
                    <option value="12">12R Target</option>
                    <option value="13">13R Target</option>
                    <option value="14">14R Target</option>
                    <option value="15">15R Target</option>
                    <option value="16">16R Target</option>
                    <option value="17">17R Target</option>
                    <option value="18">18R Target</option>
                    <option value="19">19R Target</option>
                    <option value="20">20R Target</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Bias Filter</label>
                <select id="biasFilter" onchange="updateCharts()">
                    <option value="ALL">All Bias</option>
                    <option value="LONG">Long</option>
                    <option value="SHORT">Short</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Include Breakeven</label>
                <select id="breakevenFilter" onchange="updateCharts()">
                    <option value="true">Include BE</option>
                    <option value="false">Exclude BE</option>
                </select>
            </div>
        </div>
        
        <div class="metrics-grid">
            <div class="metric-card tooltip" data-tooltip="Total number of trades in your dataset. More trades = more reliable statistics.">
                <div class="metric-label">Total Trades</div>
                <div class="metric-value" id="filteredTrades">0</div>
            </div>
            <div class="metric-card tooltip" data-tooltip="Percentage of winning trades. Good: >50%, Excellent: >60%. Includes breakeven trades as wins.">
                <div class="metric-label">Win Rate</div>
                <div class="metric-value positive" id="filteredWinRate">0%</div>
            </div>
            <div class="metric-card tooltip" data-tooltip="Gross profit ÷ gross loss. Good: >1.25, Excellent: >2.0. Measures how much you make vs lose.">
                <div class="metric-label">Profit Factor</div>
                <div class="metric-value" id="profitFactor">0.00</div>
            </div>
            <div class="metric-card tooltip" data-tooltip="Average R per trade. Positive = profitable system. Good: >0.2R, Excellent: >0.5R.">
                <div class="metric-label">Expectancy</div>
                <div class="metric-value" id="expectancy">0.00R</div>
            </div>
            <div class="metric-card tooltip" data-tooltip="Risk-adjusted return. Good: >1.0, Excellent: >2.0. Higher = better return per unit of risk.">
                <div class="metric-label">Sharpe Ratio</div>
                <div class="metric-value" id="sharpeRatio">0.00</div>
            </div>
            <div class="metric-card tooltip" data-tooltip="Largest peak-to-trough loss. Lower is better. Good: <10R, Acceptable: <20R.">
                <div class="metric-label">Max Drawdown</div>
                <div class="metric-value negative" id="maxDrawdown">0.00R</div>
            </div>
            <div class="metric-card tooltip" data-tooltip="Total return ÷ max drawdown. Good: >2.0, Excellent: >5.0. Measures profit vs worst loss.">
                <div class="metric-label">Recovery Factor</div>
                <div class="metric-value" id="recoveryFactor">0.00</div>
            </div>
            <div class="metric-card tooltip" data-tooltip="Optimal position size based on win rate and avg win/loss. Good: 10-25%, Dangerous: >50%.">
                <div class="metric-label">Kelly %</div>
                <div class="metric-value" id="kellyPercent">0.00%</div>
            </div>
        </div>
        
        <div class="advanced-metrics">
            <div class="metric-section">
                <h3>Cyclical & Seasonal Performance</h3>
                <div class="risk-metrics">
                    <div class="risk-item tooltip" data-tooltip="Best performing day of the week. Focus trading on this day for optimal results.">
                        <span>Best Day of Week</span>
                        <span id="bestDayOfWeek" class="positive">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Current month performance vs historical average. Positive = above average month.">
                        <span>Monthly Seasonality</span>
                        <span id="monthlySeasonality" class="neutral">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Performance in current quarter vs other quarters. Q1=Jan-Mar, Q2=Apr-Jun, etc.">
                        <span>Quarterly Performance</span>
                        <span id="quarterlyPerf" class="positive">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="30-day rolling expectancy. Shows recent performance trend vs long-term average.">
                        <span>30D Rolling Expectancy</span>
                        <span id="rolling30D" class="neutral">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Average days between profitable trades. Lower = more consistent profits.">
                        <span>Profit Frequency</span>
                        <span id="profitFrequency" class="positive">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Performance during high volatility periods vs low volatility. Shows market regime preference.">
                        <span>Volatility Regime</span>
                        <span id="volatilityRegime" class="neutral">Loading...</span>
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; font-size: 12px; line-height: 1.4;">
                    <strong>Cyclical Summary:</strong> <span id="cyclicalSummary">Loading seasonal analysis...</span>
                </div>
                <div style="margin-top: 10px; padding: 12px; background: rgba(0,255,136,0.1); border-radius: 8px; border: 1px solid rgba(0,255,136,0.3);">
                    <div style="font-size: 12px; opacity: 0.9; margin-bottom: 8px; color: #ffffff; font-weight: 600;">🤖 AI Cyclical Analysis:</div>
                    <div id="aiCyclicalAnalysis" style="font-size: 13px; line-height: 1.4; color: #ffffff;">Analyzing seasonal patterns and cyclical performance trends...</div>
                </div>
            </div>
            
            <div class="metric-section">
                <h3>AI Performance Intelligence</h3>
                <div class="risk-metrics">
                    <div class="risk-item tooltip" data-tooltip="AI-detected trading patterns that lead to your biggest winners. Focus on these setups.">
                        <span>Winning Pattern</span>
                        <span id="winningPattern" class="positive">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="AI confidence in next trade success based on recent sequence and patterns.">
                        <span>Next Trade Confidence</span>
                        <span id="nextTradeConfidence" class="neutral">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="AI-suggested optimal R target based on current market conditions and your performance.">
                        <span>Dynamic R-Target</span>
                        <span id="dynamicRTarget" class="positive">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="AI behavioral analysis. Green=disciplined, Yellow=caution, Red=emotional trading detected.">
                        <span>Behavioral Score</span>
                        <span id="behavioralScore" class="positive">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="AI-recommended position size based on recent performance and risk metrics.">
                        <span>Optimal Position Size</span>
                        <span id="optimalPositionSize" class="neutral">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="AI prediction of drawdown recovery time based on historical patterns.">
                        <span>Recovery Forecast</span>
                        <span id="recoveryForecast" class="positive">Loading...</span>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 15px; background: rgba(0,255,136,0.1); border-radius: 8px; border: 1px solid rgba(0,255,136,0.3);">
                    <div style="font-size: 12px; opacity: 0.9; margin-bottom: 8px; color: #ffffff; font-weight: 600;">Generative AI Strategic Analysis:</div>
                    <div id="aiInsights" style="font-size: 13px; line-height: 1.4; margin-bottom: 12px; color: #ffffff; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px;">Analyzing trading patterns and market conditions...</div>
                    <div style="font-size: 12px; opacity: 0.9; margin-bottom: 8px; color: #ffffff; font-weight: 600;">ML Risk Assessment:</div>
                    <div id="mlRiskAnalysis" style="font-size: 13px; line-height: 1.4; color: #ffffff; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px;">Processing risk patterns...</div>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; font-size: 12px; line-height: 1.4;">
                    <strong>AI Performance Summary:</strong> <span id="aiPerformanceSummary">Loading comprehensive analysis...</span>
                </div>
            </div>
            
            <div class="metric-section">
                <h3>Advanced Statistical Analysis</h3>
                <div class="risk-metrics">
                    <div class="risk-item tooltip" data-tooltip="Tests if wins/losses are random. Random = good (independent trades), Clustered = psychological patterns, Alternating = unnatural.">
                        <span>Runs Test (Randomness)</span>
                        <span id="runsTest" class="neutral">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Measures if returns are correlated. Near 0 = good (independent), Positive = momentum, Negative = mean reversion.">
                        <span>Autocorrelation (Lag-1)</span>
                        <span id="autocorrelation" class="neutral">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Risk-adjusted excess return. Good: >0.5, Excellent: >1.0. Higher = better return per unit of risk.">
                        <span>Information Ratio</span>
                        <span id="informationRatio" class="positive">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Drawdown-based risk measure. Lower = better. Good: <5, Acceptable: <10. Measures 'pain' of losses.">
                        <span>Ulcer Index</span>
                        <span id="ulcerIndex" class="negative">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Average loss in worst 5% of cases. Shows your tail risk. Less negative = better risk management.">
                        <span>Expected Shortfall (95%)</span>
                        <span id="expectedShortfall" class="negative">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Longest time to recover from losses. Shorter = better. Good: <30 days, Concerning: >90 days.">
                        <span>Max DD Duration (Days)</span>
                        <span id="maxDDDuration" class="neutral">Loading...</span>
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; font-size: 12px; line-height: 1.4;">
                    <strong>Statistical Summary:</strong> <span id="statisticalSummary">Loading statistical analysis...</span>
                </div>
                <div style="margin-top: 10px; padding: 12px; background: rgba(255,165,2,0.1); border-radius: 8px; border: 1px solid rgba(255,165,2,0.3);">
                    <div style="font-size: 12px; opacity: 0.9; margin-bottom: 8px; color: #ffffff; font-weight: 600;">📊 AI Statistical Insights:</div>
                    <div id="aiStatisticalInsights" style="font-size: 13px; line-height: 1.4; color: #ffffff;">Processing advanced statistical patterns and correlations...</div>
                </div>
            </div>
            
            <div class="metric-section">
                <h3>AI Performance Insights</h3>
                <div class="risk-metrics">
                    <div class="risk-item tooltip" data-tooltip="R-target with highest expectancy based on your MFE data. Use this target for optimal profits.">
                        <span>Optimal R-Target</span>
                        <span id="optimalRTarget" class="positive">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Trading session with highest win rate and average return. Focus your trading during this time.">
                        <span>Best Session</span>
                        <span id="bestSession" class="positive">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Overall risk assessment (0-100). Good: >70, Concerning: <30. Based on recent performance.">
                        <span>Risk Score</span>
                        <span id="riskScore" class="neutral">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Confidence in pattern recognition. Higher = more reliable predictions. Good: >80%.">
                        <span>Pattern Confidence</span>
                        <span id="patternConfidence" class="positive">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="AI prediction for next trade based on recent patterns. POSITIVE = favorable, CAUTION = be careful.">
                        <span>Next Trade Prediction</span>
                        <span id="nextTradePrediction" class="neutral">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Probability of winning after a loss. High (>70%) = good bounce-back ability, Low (<30%) = losses cluster.">
                        <span>Win After Loss Prob</span>
                        <span id="winAfterLoss" class="positive">Loading...</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Probability of losing after a win. High (>70%) = overconfidence issue, Low (<30%) = good momentum.">
                        <span>Loss After Win Prob</span>
                        <span id="lossAfterWin" class="neutral">Loading...</span>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 5px;">Markov Chain ML:</div>
                    <div id="markovInsights" style="font-size: 13px; line-height: 1.4; margin-bottom: 10px;">Analyzing trade sequences...</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 5px;">Generative AI Strategy:</div>
                    <div id="aiRecommendation" style="font-size: 13px; line-height: 1.4; margin-bottom: 10px;">Analyzing your trading patterns...</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 5px;">Neural Network Prediction:</div>
                    <div id="neuralPrediction" style="font-size: 13px; line-height: 1.4;">Processing behavioral patterns...</div>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; font-size: 12px; line-height: 1.4;">
                    <strong>AI Insights Summary:</strong> <span id="aiInsightsSummary">Loading AI analysis...</span>
                </div>
            </div>
            
            <div class="metric-section">
                <h3>Risk Analysis</h3>
                <div class="risk-metrics">
                    <div class="risk-item tooltip" data-tooltip="Value at Risk - worst expected loss 95% of the time. Less negative = better risk control.">
                        <span>VaR (95%)</span>
                        <span id="var95">0.00R</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Annual return ÷ max drawdown. Good: >1.0, Excellent: >3.0. Measures return vs worst loss.">
                        <span>Calmar Ratio</span>
                        <span id="calmarRatio">0.00</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Like Sharpe but only considers downside risk. Good: >1.0, Excellent: >2.0. Higher = better.">
                        <span>Sortino Ratio</span>
                        <span id="sortinoRatio">0.00</span>
                    </div>
                    <div class="risk-item tooltip" data-tooltip="Longest losing streak. Lower = better risk management. Good: <5, Concerning: >10.">
                        <span>Max Consecutive Losses</span>
                        <span id="maxConsecLosses">0</span>
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; font-size: 12px; line-height: 1.4;">
                    <strong>Risk Summary:</strong> <span id="riskSummary">Loading risk analysis...</span>
                </div>
                <div style="margin-top: 10px; padding: 12px; background: rgba(255,71,87,0.1); border-radius: 8px; border: 1px solid rgba(255,71,87,0.3);">
                    <div style="font-size: 12px; opacity: 0.9; margin-bottom: 8px; color: #ffffff; font-weight: 600;">⚠️ AI Risk Assessment:</div>
                    <div id="aiRiskAssessment" style="font-size: 13px; line-height: 1.4; color: #ffffff;">Evaluating risk exposure and portfolio vulnerabilities...</div>
                </div>
            </div>
        </div>
        
        <div class="main-grid">
            <div class="chart-container">
                <h3>Trade-by-Trade Equity</h3>
                <div id="d3EquityChart" style="flex: 1; min-height: 280px; margin-bottom: 15px;"></div>
                <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 11px; line-height: 1.4;">
                    <strong>What this shows:</strong> Your cumulative profit/loss over time, with each trade adding to or subtracting from your total R. A smooth upward line indicates consistent profitability.
                </div>
                <div style="margin-top: 5px; padding: 12px; background: rgba(0,255,136,0.1); border-radius: 6px; border: 1px solid rgba(0,255,136,0.3);">
                    <div style="font-size: 11px; font-weight: 600; margin-bottom: 8px; color: #00ff88;">
                        ICT Performance Analysis
                    </div>
                    <div id="equityAIAnalysis" style="font-size: 12px; line-height: 1.4; color: rgba(255,255,255,0.95);">Analyzing FVG setup quality and liquidity grab performance...</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>Daily Equity Curve</h3>
                <div id="d3DailyEquityChart" style="flex: 1; min-height: 280px; margin-bottom: 15px;"></div>
                <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 11px; line-height: 1.4;">
                    <strong>What this shows:</strong> Your daily profit/loss aggregated by trading day. Shows which days you made or lost money and helps identify daily performance patterns.
                </div>
                <div style="margin-top: 5px; padding: 10px; background: rgba(255,165,2,0.1); border-radius: 6px; border: 1px solid rgba(255,165,2,0.3);">
                    <div style="font-size: 11px; font-weight: 600; margin-bottom: 5px; color: #ffa502;">📈 AI Pattern Recognition:</div>
                    <div id="dailyAIAnalysis" style="font-size: 12px; line-height: 1.3;">Detecting daily volatility patterns and optimal sizing...</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>Weekly Equity Curve</h3>
                <div id="d3WeeklyEquityChart" style="flex: 1; min-height: 280px; margin-bottom: 15px;"></div>
                <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 11px; line-height: 1.4;">
                    <strong>What this shows:</strong> Your weekly performance over time. Each point represents a week's total profit/loss, helping identify longer-term trends and weekly consistency.
                </div>
                <div style="margin-top: 5px; padding: 10px; background: rgba(55,66,250,0.1); border-radius: 6px; border: 1px solid rgba(55,66,250,0.3);">
                    <div style="font-size: 11px; font-weight: 600; margin-bottom: 5px; color: #3742fa;">🔮 AI Trend Forecasting:</div>
                    <div id="weeklyAIAnalysis" style="font-size: 12px; line-height: 1.3;">Analyzing weekly momentum and trend sustainability...</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>Monthly Equity Curve</h3>
                <div id="d3MonthlyEquityChart" style="flex: 1; min-height: 280px; margin-bottom: 15px;"></div>
                <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 11px; line-height: 1.4;">
                    <strong>What this shows:</strong> Your monthly performance progression. Shows seasonal patterns and long-term account growth, with each point representing a month's total results.
                </div>
                <div style="margin-top: 5px; padding: 10px; background: rgba(255,71,87,0.1); border-radius: 6px; border: 1px solid rgba(255,71,87,0.3);">
                    <div style="font-size: 11px; font-weight: 600; margin-bottom: 5px; color: #ff4757;">🎯 AI Seasonal Intelligence:</div>
                    <div id="monthlyAIAnalysis" style="font-size: 12px; line-height: 1.3;">Processing seasonal patterns and monthly forecasts...</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>R-Score Distribution</h3>
                <div id="d3RScoreChart" style="flex: 1; min-height: 280px; margin-bottom: 15px;"></div>
                <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 11px; line-height: 1.4;">
                    <strong>What this shows:</strong> How often you hit different R-multiples. Shows your MFE distribution and helps determine optimal profit targets based on actual trade outcomes.
                </div>
                <div style="margin-top: 5px; padding: 10px; background: rgba(0,212,170,0.1); border-radius: 6px; border: 1px solid rgba(0,212,170,0.3);">
                    <div style="font-size: 11px; font-weight: 600; margin-bottom: 5px; color: #00d4aa;">⚡ AI Target Optimization:</div>
                    <div id="rScoreAIAnalysis" style="font-size: 12px; line-height: 1.3;">Calculating optimal R-targets from MFE distribution...</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>Day of Week Performance</h3>
                <div id="d3DayOfWeekChart" style="flex: 1; min-height: 280px; margin-bottom: 15px;"></div>
                <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 11px; line-height: 1.4;">
                    <strong>What this shows:</strong> Your average expectancy for each trading day (Monday-Friday). Helps identify which days of the week are most profitable for your strategy.
                </div>
                <div style="margin-top: 5px; padding: 10px; background: rgba(255,165,2,0.1); border-radius: 6px; border: 1px solid rgba(255,165,2,0.3);">
                    <div style="font-size: 11px; font-weight: 600; margin-bottom: 5px; color: #ffa502;">📅 AI Schedule Optimizer:</div>
                    <div id="dayOfWeekAIAnalysis" style="font-size: 12px; line-height: 1.3;">Identifying optimal trading days and schedule patterns...</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>Monthly Seasonality</h3>
                <div id="d3SeasonalityChart" style="flex: 1; min-height: 280px; margin-bottom: 15px;"></div>
                <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 11px; line-height: 1.4;">
                    <strong>What this shows:</strong> Your average expectancy for each month of the year. Reveals seasonal patterns in your trading performance and market behavior.
                </div>
                <div style="margin-top: 5px; padding: 10px; background: rgba(138,43,226,0.1); border-radius: 6px; border: 1px solid rgba(138,43,226,0.3);">
                    <div style="font-size: 11px; font-weight: 600; margin-bottom: 5px; color: #8a2be2;">🌍 AI Seasonal Predictor:</div>
                    <div id="seasonalityAIAnalysis" style="font-size: 12px; line-height: 1.3;">Detecting seasonal market cycles and performance patterns...</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>Rolling 30D Performance</h3>
                <div id="d3RollingChart" style="flex: 1; min-height: 280px; margin-bottom: 15px;"></div>
                <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 11px; line-height: 1.4;">
                    <strong>What this shows:</strong> Your 30-day rolling average expectancy over time. Smooths out daily volatility to show underlying performance trends and momentum.
                </div>
                <div style="margin-top: 5px; padding: 10px; background: rgba(0,191,255,0.1); border-radius: 6px; border: 1px solid rgba(0,191,255,0.3);">
                    <div style="font-size: 11px; font-weight: 600; margin-bottom: 5px; color: #00bfff;">🚀 AI Momentum Tracker:</div>
                    <div id="rollingAIAnalysis" style="font-size: 12px; line-height: 1.3;">Analyzing momentum strength and trend sustainability...</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>Session Performance Heatmap</h3>
                <div id="d3SessionHeatmapChart" style="flex: 1; min-height: 280px; margin-bottom: 15px;"></div>
                <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 11px; line-height: 1.4;">
                    <strong>What this shows:</strong> Win rate percentage for each trading session. Helps identify which market sessions (Asia, London, NY) work best for your strategy.
                </div>
                <div style="margin-top: 5px; padding: 10px; background: rgba(255,20,147,0.1); border-radius: 6px; border: 1px solid rgba(255,20,147,0.3);">
                    <div style="font-size: 11px; font-weight: 600; margin-bottom: 5px; color: #ff1493;">⏰ AI Session Optimizer:</div>
                    <div id="sessionAIAnalysis" style="font-size: 12px; line-height: 1.3;">Optimizing session allocation and timing strategies...</div>
                </div>
            </div>
        </div>
        
        <div class="chart-container" style="grid-column: 1 / -1; height: auto; min-height: 400px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3>Trading Performance Calendar</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="calendarView" onchange="updateCalendarView()" style="padding: 6px 10px; border-radius: 6px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
                        <option value="heatmap">Heatmap View</option>
                        <option value="day">Daily Grid</option>
                        <option value="week">Weekly View</option>
                        <option value="month">Monthly View</option>
                    </select>
                    <select id="calendarYear" onchange="updateCalendarView()" style="padding: 6px 10px; border-radius: 6px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                    </select>
                </div>
            </div>
            <div style="margin-bottom: 15px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; font-size: 12px; line-height: 1.4;">
                <strong>Calendar Summary:</strong> <span id="calendarSummary">Loading calendar analysis...</span>
            </div>
            <div id="tradingCalendar" style="padding: 10px; min-height: 300px;"></div>
            <div id="calendarLegend" style="display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; font-size: 11px;"></div>
        </div>

    </div>

    <!-- AI Chat Widget -->
    <div id="aiChatWidget" class="chat-widget">
        <div id="chatToggle" class="chat-toggle">
            <i class="fas fa-comments"></i>
        </div>
        <div id="chatContainer" class="chat-container" style="display: none;">
            <div class="chat-header">
                <span>Trading AI Assistant</span>
                <button id="chatClose" class="chat-close">&times;</button>
            </div>
            <div id="chatMessages" class="chat-messages"></div>
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Ask about your trading performance...">
                <button id="chatSend"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script>
        window.trades = [];
        

        
        function extractSession(reason) {
            if (!reason) return 'LONDON';
            if (reason.includes('LONDON')) return 'LONDON';
            if (reason.includes('NY PRE MARKET')) return 'NY PRE MARKET';
            if (reason.includes('NEW YORK AM')) return 'NEW YORK AM';
            if (reason.includes('NY LUNCH')) return 'NY LUNCH';
            if (reason.includes('NEW YORK PM')) return 'NEW YORK PM';
            return 'LONDON';
        }
        
        function extractBreakeven(reason) {
            return reason && reason.includes('R') && !reason.includes('-1R');
        }
        
        function extractRScore(reason) {
            if (!reason) return 0;
            const match = reason.match(/(-?\d+(?:\.\d+)?)R/);
            return match ? parseFloat(match[1]) : 0;
        }
        
        function getFilteredTrades() {
            const sessionCheckboxes = document.querySelectorAll('.session-filter:checked');
            const selectedSessions = Array.from(sessionCheckboxes).map(cb => cb.value);
            const biasFilter = document.getElementById('biasFilter').value;
            const breakevenFilter = document.getElementById('breakevenFilter').value === 'true';
            
            return trades.filter(trade => {
                if (selectedSessions.length > 0 && !selectedSessions.includes(trade.session)) return false;
                if (biasFilter !== 'ALL' && trade.bias !== biasFilter) return false;
                if (!breakevenFilter && trade.breakeven) return false;
                return true;
            });
        }
        
        function toggleAllSessions() {
            const allCheckbox = document.getElementById('sessionAll');
            const sessionCheckboxes = document.querySelectorAll('.session-filter');
            
            sessionCheckboxes.forEach(cb => {
                cb.checked = allCheckbox.checked;
            });
            
            updateCharts();
        }
        

        
        function updateDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZoneName: 'short'
            };
            const element = document.getElementById('currentDateTime');
            if (element) {
                element.textContent = now.toLocaleDateString('en-US', options);
            }
        }
        

        
        function changeStyle() {
            const style = document.getElementById('styleSelector').value;
            if (window.professionalStyles) {
                window.professionalStyles.setStyle(style);
            }
        }
        
        function loadStyle() {
            const savedStyle = localStorage.getItem('professionalStyle') || 'slate';
            const selector = document.getElementById('styleSelector');
            if (selector) {
                selector.value = savedStyle;
            }
        }
        
        function loadFilterStates() {
            // Load saved filter states from localStorage
            const savedSessionStates = JSON.parse(localStorage.getItem('sessionFilters') || '{}');
            const sessionCheckboxes = document.querySelectorAll('.session-filter');
            sessionCheckboxes.forEach(cb => {
                if (savedSessionStates.hasOwnProperty(cb.value)) {
                    cb.checked = savedSessionStates[cb.value];
                }
            });
        }
        
        // Chat functionality
        function initChat() {
            const toggle = document.getElementById('chatToggle');
            const container = document.getElementById('chatContainer');
            const close = document.getElementById('chatClose');
            const send = document.getElementById('chatSend');
            const input = document.getElementById('chatInput');
            const messages = document.getElementById('chatMessages');

            if (toggle && container) {
                toggle.onclick = () => {
                    container.style.display = container.style.display === 'none' ? 'flex' : 'none';
                };
            }

            if (close && container) {
                close.onclick = () => container.style.display = 'none';
            }

            if (send && input) {
                send.onclick = () => sendMessage();
                input.onkeypress = (e) => { if (e.key === 'Enter') sendMessage(); };
            }

            function addMessage(type, content) {
                if (!messages) return;
                const msg = document.createElement('div');
                msg.className = `chat-message ${type}`;
                msg.innerHTML = `<div class="message-content">${content}</div>`;
                messages.appendChild(msg);
                messages.scrollTop = messages.scrollHeight;
            }

            function sendMessage() {
                if (!input) return;
                const message = input.value.trim();
                if (!message) return;

                addMessage('user', message);
                input.value = '';

                // Simple response for now
                setTimeout(() => {
                    addMessage('ai', 'I can help you analyze your trading performance. What would you like to know?');
                }, 500);
            }
        }
        
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing...');
            loadFilterStates();
            loadStyle();
            loadTradesFromDB();
            initChat();
            
            // Start updates
            updateDateTime();
            updateMarketStatus();
            setInterval(updateDateTime, 1000);
            setInterval(updateMarketStatus, 60000);
        });
    </script>
</body>
</html>