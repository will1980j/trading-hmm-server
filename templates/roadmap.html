<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Roadmap - Trading Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #0a1628 0%, #0d2240 100%);
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            min-height: 100vh;
            padding: 20px 0;
        }
        
        .roadmap-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .roadmap-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 20px;
            background: rgba(15,23,42,0.6);
            border-radius: 12px;
            border: 1px solid rgba(59,130,246,0.2);
        }
        
        .roadmap-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 10px;
        }
        
        .roadmap-subtitle {
            font-size: 1.1rem;
            color: #94a3b8;
        }
        
        .current-focus-banner {
            background: rgba(251,191,36,0.15);
            border: 2px solid rgba(251,191,36,0.4);
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .current-focus-label {
            color: #fbbf24;
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .current-focus-phase {
            color: #fde047;
            font-size: 1.3rem;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .phase-card {
            background: rgba(15,23,42,0.6);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid rgba(148,163,184,0.2);
            transition: all 0.3s ease;
        }
        
        .phase-card.complete {
            border-color: rgba(34,197,94,0.4);
            background: rgba(34,197,94,0.05);
        }
        
        .phase-card.in-progress {
            border-color: rgba(251,191,36,0.4);
            background: rgba(251,191,36,0.05);
            box-shadow: 0 0 20px rgba(251,191,36,0.2);
        }
        
        .phase-card.not-enabled {
            border-color: rgba(100,116,139,0.2);
            opacity: 0.7;
        }
        
        .phase-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .phase-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: #e2e8f0;
        }
        
        .phase-card.complete .phase-name {
            color: #4ade80;
        }
        
        .phase-card.in-progress .phase-name {
            color: #fbbf24;
        }
        
        .status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-complete {
            background: rgba(34,197,94,0.3);
            color: #4ade80;
        }
        
        .status-in-progress {
            background: rgba(251,191,36,0.3);
            color: #fbbf24;
        }
        
        .status-not-enabled {
            background: rgba(100,116,139,0.2);
            color: #94a3b8;
        }
        
        .phase-objective {
            color: #cbd5e1;
            font-size: 1rem;
            margin-bottom: 15px;
            font-style: italic;
        }
        
        .phase-description {
            color: #94a3b8;
            font-size: 0.9rem;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
        }
        
        .deliverables-title {
            color: #3b82f6;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .deliverables-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .deliverables-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            color: #cbd5e1;
            font-size: 0.95rem;
        }
        
        .deliverables-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #3b82f6;
            font-weight: 700;
        }
        
        .phase-card.complete .deliverables-list li:before {
            color: #4ade80;
        }
        
        .phase-card.in-progress .deliverables-list li:before {
            color: #fbbf24;
        }
        
        .rules-section {
            margin-top: 15px;
            padding: 12px;
            background: rgba(239,68,68,0.1);
            border: 1px solid rgba(239,68,68,0.3);
            border-radius: 6px;
        }
        
        .rules-title {
            color: #fca5a5;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .rules-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .rules-list li {
            padding: 4px 0;
            padding-left: 20px;
            position: relative;
            color: #fca5a5;
            font-size: 0.85rem;
        }
        
        .rules-list li:before {
            content: "‚úó";
            position: absolute;
            left: 0;
            color: #ef4444;
            font-weight: 700;
        }
        
        .back-button {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(59,130,246,0.2);
            color: #3b82f6;
            text-decoration: none;
            border-radius: 8px;
            border: 1px solid rgba(59,130,246,0.3);
            font-weight: 600;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .back-button:hover {
            background: rgba(59,130,246,0.3);
            color: #60a5fa;
            transform: translateX(-5px);
        }
        
        .data-state-card {
            background: rgba(15,23,42,0.6);
            border: 1px solid rgba(59,130,246,0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .data-state-title {
            color: #3b82f6;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .data-stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(148,163,184,0.1);
        }
        
        .data-stat:last-child {
            border-bottom: none;
        }
        
        .data-label {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        .data-value {
            color: #e2e8f0;
            font-weight: 600;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="roadmap-container">
        <a href="/homepage" class="back-button">‚Üê Back to Homepage</a>
        
        <div class="roadmap-header">
            <h1 class="roadmap-title">System Roadmap</h1>
            <p class="roadmap-subtitle">Databento-First Trading Research & Execution Platform</p>
        </div>
        
        <div class="current-focus-banner">
            <div class="current-focus-label">Current Focus</div>
            <div class="current-focus-phase" id="current-focus-text">Loading...</div>
        </div>
        
        <div class="data-state-card">
            <div class="data-state-title">üìä Data Foundation</div>
            <div class="data-stat">
                <span class="data-label">Symbol</span>
                <span class="data-value" id="data-symbol">--</span>
            </div>
            <div class="data-stat">
                <span class="data-label">Date Range</span>
                <span class="data-value" id="data-range">--</span>
            </div>
            <div class="data-stat">
                <span class="data-label">Total Bars</span>
                <span class="data-value" id="data-bars">--</span>
            </div>
            <div class="data-stat">
                <span class="data-label">Granularity</span>
                <span class="data-value">1-minute</span>
            </div>
        </div>
        
        <div id="phases-container">
            <div class="text-center" style="padding: 40px; color: #94a3b8;">
                <div class="spinner-border" role="status"></div>
                <div class="mt-3">Loading roadmap...</div>
            </div>
        </div>
    </div>
    
    <script>
        async function loadRoadmap() {
            try {
                const resp = await fetch('/api/roadmap', { cache: 'no-store' });
                const data = await resp.json();
                
                console.log('[ROADMAP] API response:', data);
                
                // Extract phases from correct path: data.phases (not data.roadmap_v3.phases)
                // The API returns phases directly at top level
                const phases = data.phases || [];
                
                // TASK 1: Current focus from overall.active_phase_name
                const currentFocusText = data.overall?.active_phase_name || 
                                        'Phase C ‚Äî Historical Signal Generation (RAW)';
                document.getElementById('current-focus-text').textContent = currentFocusText;
                
                // Data foundation from source_of_truth
                const sourceOfTruth = data.source_of_truth || {};
                document.getElementById('data-symbol').textContent = sourceOfTruth.symbol || 'NQ';
                document.getElementById('data-range').textContent = sourceOfTruth.date_range || '2010-2025';
                document.getElementById('data-bars').textContent = sourceOfTruth.total_bars || '~5.25M';
                
                // IMPORTANT: Sort phases into A‚ÜíJ order (PA, P1, P2, P3, P4, P4.5, P5, P6, P7, P8, P9)
                const phaseOrder = ['PA', 'P1', 'P2', 'P3', 'P4', 'P4.5', 'P5', 'P6', 'P7', 'P8', 'P9'];
                const sortedPhases = phases.sort((a, b) => {
                    const indexA = phaseOrder.indexOf(a.phase_id);
                    const indexB = phaseOrder.indexOf(b.phase_id);
                    return (indexA === -1 ? 999 : indexA) - (indexB === -1 ? 999 : indexB);
                });
                
                // Render phases
                const container = document.getElementById('phases-container');
                container.innerHTML = '';
                
                sortedPhases.forEach(phase => {
                    // TASK 2: Map CSS class based on status prefix/content
                    let cardClass = 'not-enabled';
                    let statusClass = 'status-not-enabled';
                    
                    const status = phase.status || '';
                    if (status.startsWith('COMPLETE')) {
                        cardClass = 'complete';
                        statusClass = 'status-complete';
                    } else if (status.includes('IN_PROGRESS')) {
                        cardClass = 'in-progress';
                        statusClass = 'status-in-progress';
                    } else if (status.includes('NOT') || status.includes('DISABLED')) {
                        cardClass = 'not-enabled';
                        statusClass = 'status-not-enabled';
                    }
                    
                    const card = document.createElement('div');
                    card.className = `phase-card ${cardClass}`;
                    
                    // TASK 2: Use phase.status as badge text exactly (no rewriting)
                    const statusText = status || 'UNKNOWN';
                    
                    let html = `
                        <div class="phase-header">
                            <div class="phase-name">${phase.name}</div>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                        <div class="phase-objective">${phase.objective}</div>
                    `;
                    
                    // Add description if present
                    if (phase.description) {
                        html += `<div class="phase-description">${phase.description}</div>`;
                    }
                    
                    // Add deliverables
                    const deliverables = phase.deliverables || [];
                    if (deliverables.length > 0) {
                        html += '<div class="deliverables-title">Deliverables</div>';
                        html += '<ul class="deliverables-list">';
                        deliverables.forEach(d => {
                            html += `<li>${d}</li>`;
                        });
                        html += '</ul>';
                    }
                    
                    // Add rules if present
                    const rules = phase.rules || [];
                    if (rules.length > 0) {
                        html += '<div class="rules-section">';
                        html += '<div class="rules-title">Scope Restrictions</div>';
                        html += '<ul class="rules-list">';
                        rules.forEach(r => {
                            html += `<li>${r}</li>`;
                        });
                        html += '</ul>';
                        html += '</div>';
                    }
                    
                    card.innerHTML = html;
                    container.appendChild(card);
                });
                
                console.log(`[ROADMAP] Rendered ${sortedPhases.length} phases`);
                
            } catch (error) {
                console.error('[ROADMAP] Error loading roadmap:', error);
                document.getElementById('phases-container').innerHTML = 
                    '<div class="alert alert-danger">Failed to load roadmap. Check console for details.</div>';
                document.getElementById('current-focus-text').textContent = 'Error loading roadmap';
            }
        }
        
        // Load on page ready
        document.addEventListener('DOMContentLoaded', loadRoadmap);
    </script>
</body>
</html>
