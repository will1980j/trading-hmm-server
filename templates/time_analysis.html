<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Analysis - Second Skies Trading</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/time_analysis.css') }}">
    <!-- Chart.js (latest stable) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- TOP NAVIGATION BAR -->
    <header class="topbar">
        <button class="topbar-back" onclick="window.location.href='/homepage'">‚Üê Back</button>
        <div class="topbar-divider">|</div>
        <div class="topbar-title">Time Analysis</div>
    </header>

    <!-- REGION A: HEADER & METRIC SUMMARY -->
    <div class="header-section">
        <div class="ta-header">
            <div class="ta-header-left">
                <h1 class="page-title">Time Analysis</h1>
                <div class="ta-subtitle">Live performance overview from automated signals</div>
            </div>
            <div class="ta-header-right">
                <div class="ta-filter-row">
                    <input type="date" id="startDateInput" placeholder="Start Date">
                    <input type="date" id="endDateInput" placeholder="End Date">
                    <select id="sessionFilter">
                        <option value="">All Sessions</option>
                        <option value="ASIA">ASIA</option>
                        <option value="LONDON">LONDON</option>
                        <option value="NY PRE">NY PRE</option>
                        <option value="NY AM">NY AM</option>
                        <option value="NY LUNCH">NY LUNCH</option>
                        <option value="NY PM">NY PM</option>
                    </select>
                    <select id="directionFilter">
                        <option value="">Both</option>
                        <option value="Bullish">Bullish</option>
                        <option value="Bearish">Bearish</option>
                    </select>
                </div>
                <div class="ta-stat-row">
                    <div class="metric-block">
                        <span class="metric-label">Win Rate</span>
                        <span class="metric-value" id="winRateValue">--</span>
                    </div>
                    <div class="metric-block">
                        <span class="metric-label">Expectancy</span>
                        <span class="metric-value" id="expectancyValue">--</span>
                    </div>
                    <div class="metric-block">
                        <span class="metric-label">Avg R</span>
                        <span class="metric-value" id="avgRValue">--</span>
                    </div>
                    <div class="metric-block">
                        <span class="metric-label">Total Trades</span>
                        <span class="metric-value" id="totalTradesValue">--</span>
                    </div>
                    <div class="metric-block highlight">
                        <span class="metric-label">Best Session</span>
                        <span class="metric-value" id="bestSessionValue">--</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- REGION B: SESSION PERFORMANCE -->
    <section class="ta-section" id="sessionPerformanceSection">
        <h2 class="ta-section-title">Session Performance</h2>
        <div class="session-grid" id="sessionGrid">
            <!-- Session cards will be rendered here via JS -->
        </div>
    </section>

    <!-- REGION C: SESSION √ó HOUR HEATMAP -->
    <section class="ta-section" id="sessionHeatmapSection">
        <h2 class="ta-section-title">Session √ó Hour R Heatmap</h2>
        <div class="heatmap-container">
            <canvas id="sessionHeatmapCanvas"></canvas>
        </div>
    </section>

    <!-- REGION D: HOURLY PERFORMANCE -->
    <section class="ta-section" id="hourlyPerformanceSection">
        <h2 class="ta-section-title">Hourly Performance</h2>
        <div class="hourly-grid" id="hourlyGrid">
            <!-- JS will render hourly cards here -->
        </div>
    </section>

    <!-- REGION E: DAY OF WEEK PERFORMANCE -->
    <section class="ta-section" id="dayOfWeekSection">
        <h2 class="ta-section-title">Day of Week Performance</h2>
        <div class="dow-grid" id="dayOfWeekGrid">
            <!-- JS will inject day cards -->
        </div>
    </section>

    <!-- REGION F: WEEK OF MONTH PERFORMANCE -->
    <section class="ta-section" id="weekOfMonthSection">
        <h2 class="ta-section-title">Week of Month Performance</h2>
        <div class="wom-grid" id="weekOfMonthGrid">
            <!-- JS will inject WOM cards -->
        </div>
    </section>

    <!-- REGION G: MONTH OF YEAR PERFORMANCE -->
    <section class="ta-section" id="monthOfYearSection">
        <h2 class="ta-section-title">Month of Year Performance</h2>
        <div class="moy-grid" id="monthOfYearGrid">
            <!-- JS will inject MOY cards -->
        </div>
    </section>

    <!-- REGION H: MACRO WINDOW ANALYSIS -->
    <section class="ta-section" id="macroWindowSection">
        <h2 class="ta-section-title">Macro Window Performance</h2>
        <div class="macro-grid" id="macroGrid">
            <!-- Cards for Macro vs Non-Macro will go here -->
        </div>
    </section>

    <!-- REGION I: R-MULTIPLE DISTRIBUTION -->
    <section class="ta-section" id="rDistSection">
        <h2 class="ta-section-title">R-Multiple Distribution</h2>
        <div class="r-dist-container">
            <canvas id="rDistCanvas"></canvas>
        </div>
    </section>

    <!-- ========================================== -->
    <!-- TEMPORAL EDGE V1 - TRUSTED SIGNALS ONLY -->
    <!-- ========================================== -->
    <section class="ta-section" id="temporalEdgeV1Section" style="border-top: 3px solid #3b82f6; margin-top: 40px; padding-top: 30px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 class="ta-section-title">‚è±Ô∏è Temporal Edge V1</h2>
            <div style="background: rgba(59,130,246,0.1); border: 1px solid rgba(59,130,246,0.3); border-radius: 8px; padding: 8px 16px; font-size: 12px; color: #93c5fd;">
                Using valid_market_window=true and metrics present only
            </div>
        </div>
        
        <!-- BLOCK A: Session Transition Sensitivity -->
        <div style="background: rgba(15,23,42,0.6); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
            <h3 style="color: #e2e8f0; font-size: 16px; margin-bottom: 16px;">üìä Session Transition Sensitivity</h3>
            <div id="te-session-transitions-table"></div>
        </div>
        
        <!-- BLOCK B: Time-to-1R / Time-to-Failure -->
        <div style="background: rgba(15,23,42,0.6); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
            <h3 style="color: #e2e8f0; font-size: 16px; margin-bottom: 16px;">‚è∞ Time-to-1R / Time-in-Trade</h3>
            <div id="te-time-to-1r-content"></div>
        </div>
        
        <!-- BLOCK C: Signal Age Decay -->
        <div style="background: rgba(15,23,42,0.6); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
            <h3 style="color: #e2e8f0; font-size: 16px; margin-bottom: 16px;">‚è≥ Signal Age Decay</h3>
            <div id="te-signal-age-table"></div>
        </div>
    </section>

    <!-- REGION J: ADVANCED LIFECYCLE ANALYTICS (ROADMAP-LOCKED) -->
    <section class="ta-section" id="lifecycleAdvancedSection">
        <h2 class="ta-section-title">Advanced Lifecycle Analytics</h2>
        {% from '_macros.html' import roadmap_locked %}
        {{ roadmap_locked("H2.lifecycle_analytics", "Lifecycle timeline analysis (Coming in later roadmap phases)") }}
    </section>

    <script src="{{ url_for('static', filename='js/time_analysis.js') }}"></script>
</body>
</html>
