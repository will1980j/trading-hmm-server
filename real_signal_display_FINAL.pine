//@version=5
indicator("Real Signal Display", overlay=true, max_labels_count=50)

// Display settings
show_signals = input.bool(true, "Show Live Signals")
label_size = input.string("Normal", "Label Size", options=["Tiny", "Small", "Normal", "Large"])
bull_color = input.color(color.new(#00ff88, 0), "Bullish Color")
bear_color = input.color(color.new(#ff4757, 0), "Bearish Color")
text_color = input.color(color.white, "Text Color")

get_label_size() =>
    switch label_size
        "Tiny" => size.tiny
        "Small" => size.small
        "Normal" => size.normal
        "Large" => size.large
        => size.normal

// Alert condition - this creates the webhook trigger
alertcondition(true, title="Chart Display Signal", message="CHART_SIGNAL_REQUEST")

// ONLY show signal when manually triggered - NOT automatic
var int last_signal_bar = 0
var int signal_counter = 0

// Manual trigger condition - change this to your preferred trigger
manual_trigger = false  // Set to false to prevent automatic signals

if barstate.isconfirmed and show_signals and manual_trigger and bar_index != last_signal_bar
    last_signal_bar := bar_index
    signal_counter := signal_counter + 1
    
    // Determine signal direction
    current_bias = close > close[5] ? "Bullish" : "Bearish"
    
    // Create professional signal label
    direction_icon = current_bias == "Bullish" ? "â–²" : "â–¼"
    signal_title = current_bias == "Bullish" ? "LONG" : "SHORT"
    
    // Professional label text
    label_text = direction_icon + " " + signal_title + " SIGNAL\n" + 
                 "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" +
                 "ğŸ’ª Strength: 85%\n" +
                 "ğŸ’° Price: " + str.tostring(close, "#.##") + "\n" +
                 "â° " + str.format_time(time, "HH:mm", "America/New_York")
    
    signal_color = current_bias == "Bullish" ? bull_color : bear_color
    signal_style = current_bias == "Bullish" ? label.style_label_up : label.style_label_down
    signal_y = current_bias == "Bullish" ? low - (high-low)*0.15 : high + (high-low)*0.15
    
    label.new(bar_index, signal_y, 
              label_text,
              color=color.new(signal_color, 10), 
              textcolor=text_color, 
              style=signal_style, 
              size=get_label_size(),
              tooltip="Live Signal from Webhook")

// Performance table
var table perf_table = table.new(position.top_right, 2, 3, bgcolor=color.new(color.black, 85), border_width=1)

if barstate.islast
    table.cell(perf_table, 0, 0, "ğŸ”¥ LIVE SIGNALS", text_color=color.white, bgcolor=color.new(#1a1a2e, 0))
    table.cell(perf_table, 1, 0, "ğŸ“Š STATUS", text_color=color.white, bgcolor=color.new(#1a1a2e, 0))
    
    table.cell(perf_table, 0, 1, "Total Signals", text_color=color.white)
    table.cell(perf_table, 1, 1, str.tostring(signal_counter), text_color=color.new(#00ff88, 0))
    
    table.cell(perf_table, 0, 2, "Data Source", text_color=color.white)
    table.cell(perf_table, 1, 2, "ğŸŒ WEBHOOK", text_color=color.new(#00ff88, 0))