<!-- Live System Diagnostics Terminal -->
<style>
    .diagnostic-terminal {
        background: rgba(26, 31, 58, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 20px;
        font-family: 'Courier New', monospace;
        color: #e0e0e0;
        height: 600px;
        overflow-y: auto;
        position: relative;
    }
    
    .terminal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .terminal-title {
        font-size: 16px;
        font-weight: bold;
        color: #e0e0e0;
    }
    
    .terminal-status {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }
    
    .status-healthy { background: #10b981; }
    .status-warning { background: #f59e0b; }
    .status-critical { background: #ef4444; }
    .status-running { background: #3b82f6; }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }
    
    .terminal-output {
        font-size: 13px;
        line-height: 1.6;
    }
    
    .terminal-line {
        margin: 5px 0;
        opacity: 0;
        animation: fadeIn 0.3s forwards;
    }
    
    @keyframes fadeIn {
        to { opacity: 1; }
    }
    
    .check-pass { color: #10b981; }
    .check-warn { color: #f59e0b; }
    .check-fail { color: #ef4444; }
    .check-info { color: #3b82f6; }
    
    .check-line {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 5px 0;
    }
    
    .check-icon {
        font-size: 16px;
        min-width: 20px;
    }
    
    .check-name {
        font-weight: bold;
        min-width: 200px;
    }
    
    .check-message {
        color: #aaa;
    }
    
    .progress-bar {
        width: 100%;
        height: 4px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
        overflow: hidden;
        margin: 10px 0;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #3b82f6, #10b981);
        width: 0%;
        transition: width 0.3s ease;
    }
    
    .diagnostic-chart {
        margin: 15px 0;
        padding: 15px;
        background: rgba(26, 31, 58, 0.4);
        border-radius: 5px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .chart-title {
        color: #e0e0e0;
        font-size: 14px;
        margin-bottom: 10px;
        text-transform: uppercase;
    }
    
    .bar-chart {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .bar-item {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .bar-label {
        min-width: 120px;
        color: #aaa;
        font-size: 12px;
    }
    
    .bar-visual {
        flex: 1;
        height: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 3px;
        overflow: hidden;
        position: relative;
    }
    
    .bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #3b82f6, #10b981);
        transition: width 0.5s ease;
    }
    
    .bar-value {
        min-width: 50px;
        text-align: right;
        color: #e0e0e0;
        font-size: 12px;
    }
    
    .summary-box {
        background: rgba(26, 31, 58, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 5px;
        padding: 15px;
        margin: 15px 0;
    }
    
    .summary-title {
        color: #e0e0e0;
        font-size: 14px;
        margin-bottom: 10px;
        text-transform: uppercase;
    }
    
    .summary-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    
    .summary-item {
        display: flex;
        justify-content: space-between;
        padding: 5px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 3px;
    }
    
    .summary-label {
        color: #aaa;
        font-size: 12px;
    }
    
    .summary-value {
        color: #00ff00;
        font-weight: bold;
        font-size: 12px;
    }
    
    .typing-cursor {
        display: inline-block;
        width: 8px;
        height: 14px;
        background: #00ff00;
        margin-left: 2px;
        animation: blink 1s infinite;
    }
    
    @keyframes blink {
        0%, 49% { opacity: 1; }
        50%, 100% { opacity: 0; }
    }
    
    .scan-animation {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, transparent, #00ff00, transparent);
        animation: scan 2s linear infinite;
        pointer-events: none;
    }
    
    @keyframes scan {
        0% { transform: translateY(0); }
        100% { transform: translateY(600px); }
    }
</style>

<div class="diagnostic-terminal" id="diagnosticTerminal">
    <div class="scan-animation"></div>
    
    <div class="terminal-header">
        <div class="terminal-title">
            üîç LIVE SYSTEM DIAGNOSTICS
        </div>
        <div class="terminal-status">
            <div class="status-indicator status-running" id="statusIndicator"></div>
            <span id="statusText">INITIALIZING...</span>
        </div>
    </div>
    
    <div class="progress-bar">
        <div class="progress-fill" id="progressBar"></div>
    </div>
    
    <div class="terminal-output" id="terminalOutput">
        <div class="terminal-line check-info">
            üöÄ System Diagnostics Engine v2.0<span class="typing-cursor"></span>
        </div>
        <div class="terminal-line check-info">
            üîÑ Initializing comprehensive health checks...
        </div>
    </div>
</div>

<script>
class DiagnosticTerminal {
    constructor() {
        this.output = document.getElementById('terminalOutput');
        this.progressBar = document.getElementById('progressBar');
        this.statusIndicator = document.getElementById('statusIndicator');
        this.statusText = document.getElementById('statusText');
        this.checkDelay = 300; // ms between checks for visual effect
        this.autoRunInterval = 30000; // Run every 30 seconds
        this.isRunning = false;
    }
    
    async start() {
        if (this.isRunning) return;
        this.isRunning = true;
        
        this.clear();
        this.addLine('üîç Starting diagnostic scan...', 'info');
        this.addLine('üîå Connecting to Railway database...', 'info');
        
        await this.sleep(500);
        
        try {
            const response = await fetch('/api/automated-signals/diagnostics/run');
            const data = await response.json();
            
            await this.displayResults(data);
            
            // Schedule next run
            setTimeout(() => {
                this.isRunning = false;
                this.start();
            }, this.autoRunInterval);
            
        } catch (error) {
            this.addLine(`‚úó ERROR: ${error.message}`, 'fail');
            this.updateStatus('critical', 'ERROR');
            this.isRunning = false;
        }
    }
    
    async displayResults(data) {
        const totalChecks = data.checks.length;
        
        // Display each check with animation
        for (let i = 0; i < data.checks.length; i++) {
            const check = data.checks[i];
            const progress = ((i + 1) / totalChecks) * 100;
            this.progressBar.style.width = `${progress}%`;
            
            const icon = check.status === 'PASS' ? '‚úÖ' : 
                        check.status === 'WARN' ? '‚ö†Ô∏è' : 
                        check.status === 'FAIL' ? '‚ùå' : '‚ÑπÔ∏è';
            
            const statusClass = check.status === 'PASS' ? 'pass' : 
                               check.status === 'WARN' ? 'warn' : 
                               check.status === 'FAIL' ? 'fail' : 'info';
            
            this.addCheckLine(icon, check.name, check.message, statusClass);
            
            await this.sleep(this.checkDelay);
        }
        
        // Display summary
        await this.sleep(500);
        this.addLine('', 'info');
        this.addLine('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
        this.addLine('üìã DIAGNOSTIC SUMMARY', 'info');
        this.addLine('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
        
        // Create summary box
        this.addSummaryBox(data);
        
        // Display charts if data available
        if (data.checks.length > 4 && data.checks[4].data) {
            this.addEventDistributionChart(data.checks[4].data);
        }
        
        if (data.checks.length > 9 && data.checks[9].data) {
            this.addSessionDistributionChart(data.checks[9].data);
        }
        
        // Update status
        const statusMap = {
            'HEALTHY': { class: 'healthy', text: 'ALL SYSTEMS OPERATIONAL' },
            'WARNING': { class: 'warning', text: `${data.warnings.length} WARNING(S) DETECTED` },
            'CRITICAL': { class: 'critical', text: `${data.critical_issues.length} CRITICAL ISSUE(S)` },
            'ERROR': { class: 'critical', text: 'SYSTEM ERROR' }
        };
        
        const status = statusMap[data.overall_status] || statusMap['ERROR'];
        this.updateStatus(status.class, status.text);
        
        // Display warnings/issues
        if (data.warnings.length > 0) {
            this.addLine('', 'info');
            this.addLine('‚ö†Ô∏è WARNINGS:', 'warn');
            data.warnings.forEach(w => this.addLine(`  ‚Ä¢ ${w}`, 'warn'));
        }
        
        if (data.critical_issues.length > 0) {
            this.addLine('', 'info');
            this.addLine('‚ùå CRITICAL ISSUES:', 'fail');
            data.critical_issues.forEach(i => this.addLine(`  ‚Ä¢ ${i}`, 'fail'));
        }
        
        this.addLine('', 'info');
        this.addLine(`‚úÖ Scan completed at ${new Date().toLocaleTimeString()}`, 'info');
        this.addLine(`‚è±Ô∏è Next scan in ${this.autoRunInterval/1000} seconds...`, 'info');
    }
    
    addCheckLine(icon, name, message, statusClass) {
        const line = document.createElement('div');
        line.className = `terminal-line check-line check-${statusClass}`;
        line.innerHTML = `
            <span class="check-icon">${icon}</span>
            <span class="check-name">${name}</span>
            <span class="check-message">${message}</span>
        `;
        this.output.appendChild(line);
        this.scrollToBottom();
    }
    
    addLine(text, type = 'info') {
        const line = document.createElement('div');
        line.className = `terminal-line check-${type}`;
        line.textContent = text;
        this.output.appendChild(line);
        this.scrollToBottom();
    }
    
    addSummaryBox(data) {
        const box = document.createElement('div');
        box.className = 'summary-box';
        
        const passCount = data.checks.filter(c => c.status === 'PASS').length;
        const warnCount = data.checks.filter(c => c.status === 'WARN').length;
        const failCount = data.checks.filter(c => c.status === 'FAIL').length;
        
        box.innerHTML = `
            <div class="summary-title">üìä System Health Metrics</div>
            <div class="summary-grid">
                <div class="summary-item">
                    <span class="summary-label">üîç Total Checks:</span>
                    <span class="summary-value">${data.checks.length}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">‚úÖ Passed:</span>
                    <span class="summary-value" style="color: #10b981;">${passCount}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">‚ö†Ô∏è Warnings:</span>
                    <span class="summary-value" style="color: #f59e0b;">${warnCount}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">‚ùå Failed:</span>
                    <span class="summary-value" style="color: #ef4444;">${failCount}</span>
                </div>
            </div>
        `;
        
        this.output.appendChild(box);
        this.scrollToBottom();
    }
    
    addEventDistributionChart(data) {
        const chart = document.createElement('div');
        chart.className = 'diagnostic-chart';
        
        const maxValue = Math.max(...Object.values(data));
        const bars = Object.entries(data)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 5)
            .map(([label, value]) => {
                const percentage = (value / maxValue) * 100;
                return `
                    <div class="bar-item">
                        <div class="bar-label">${label}</div>
                        <div class="bar-visual">
                            <div class="bar-fill" style="width: ${percentage}%"></div>
                        </div>
                        <div class="bar-value">${value}</div>
                    </div>
                `;
            }).join('');
        
        chart.innerHTML = `
            <div class="chart-title">üìà Event Distribution (24h)</div>
            <div class="bar-chart">${bars}</div>
        `;
        
        this.output.appendChild(chart);
        this.scrollToBottom();
    }
    
    addSessionDistributionChart(data) {
        const chart = document.createElement('div');
        chart.className = 'diagnostic-chart';
        
        const maxValue = Math.max(...Object.values(data));
        const bars = Object.entries(data)
            .sort((a, b) => b[1] - a[1])
            .map(([label, value]) => {
                const percentage = (value / maxValue) * 100;
                return `
                    <div class="bar-item">
                        <div class="bar-label">${label}</div>
                        <div class="bar-visual">
                            <div class="bar-fill" style="width: ${percentage}%"></div>
                        </div>
                        <div class="bar-value">${value}</div>
                    </div>
                `;
            }).join('');
        
        chart.innerHTML = `
            <div class="chart-title">‚è∞ Session Distribution (24h)</div>
            <div class="bar-chart">${bars}</div>
        `;
        
        this.output.appendChild(chart);
        this.scrollToBottom();
    }
    
    updateStatus(statusClass, text) {
        this.statusIndicator.className = `status-indicator status-${statusClass}`;
        this.statusText.textContent = text;
    }
    
    clear() {
        this.output.innerHTML = '';
        this.progressBar.style.width = '0%';
    }
    
    scrollToBottom() {
        const terminal = document.getElementById('diagnosticTerminal');
        terminal.scrollTop = terminal.scrollHeight;
    }
    
    sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
}

// Initialize and start
const diagnosticTerminal = new DiagnosticTerminal();
diagnosticTerminal.start();
</script>
