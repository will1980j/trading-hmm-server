<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Data Extractor - Trading Analytics</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            padding: 30px;
            background: rgba(255,255,255,0.08);
            border-radius: 20px;
            margin-bottom: 30px;
        }
        .extractor-section {
            background: rgba(255,255,255,0.08);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .trade-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            font-size: 12px;
            margin-bottom: 5px;
            opacity: 0.8;
        }
        .form-group input, .form-group select {
            padding: 8px;
            border: none;
            border-radius: 6px;
            background: white;
            color: black;
            font-size: 14px;
        }
        .btn {
            background: linear-gradient(45deg, #00ff88, #00d4aa);
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 5px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,255,136,0.4);
        }
        .trades-list {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .trade-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            align-items: center;
        }
        .mfe-positive { color: #00ff88; font-weight: bold; }
        .mfe-negative { color: #ff4757; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Chart Data Extractor</h1>
            <p>Extract trade data from chart images and add to Signal Lab</p>
        </div>

        <div class="extractor-section">
            <h3>Pre-filled Data from Chart Analysis</h3>
            <p>ASIA SESSION ANALYSIS: 9 trades identified</p>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 15px 0; text-align: center;">
                <div style="background: rgba(0,255,136,0.2); padding: 10px; border-radius: 8px;">
                    <strong style="color: #00ff88;">✅ WINNERS: 7</strong><br>
                    <small>MFE ≥ 1R target</small>
                </div>
                <div style="background: rgba(255,71,87,0.2); padding: 10px; border-radius: 8px;">
                    <strong style="color: #ff4757;">❌ LOSERS: 2</strong><br>
                    <small>MFE < 1R target</small>
                </div>
                <div style="background: rgba(255,165,0,0.2); padding: 10px; border-radius: 8px;">
                    <strong style="color: #ffa502;">⚖️ BREAKEVEN: 0</strong><br>
                    <small>None in Asia</small>
                </div>
            </div>
            <p><strong>Asia Win Rate: 77.8% (7/9)</strong></p>
            
            <div id="extractedTrades">
                <!-- Trades will be populated here -->
            </div>
            
            <button class="btn" onclick="addAllToSignalLab()">Add All Trades to Signal Lab</button>
        </div>

        <div class="extractor-section">
            <h3>Manual Trade Entry</h3>
            <div class="trade-form">
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="tradeDate">
                </div>
                <div class="form-group">
                    <label>Time</label>
                    <input type="time" id="tradeTime">
                </div>
                <div class="form-group">
                    <label>Bias</label>
                    <select id="tradeBias">
                        <option value="Bullish">Bullish</option>
                        <option value="Bearish">Bearish</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Session</label>
                    <select id="tradeSession">
                        <option value="London">London</option>
                        <option value="NY AM">NY AM</option>
                        <option value="NY PM">NY PM</option>
                        <option value="Asia">Asia</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Signal Type</label>
                    <select id="signalType">
                        <option value="Bearish FVG">Bearish FVG</option>
                        <option value="Bullish FVG">Bullish FVG</option>
                        <option value="Bearish IFVG">Bearish IFVG</option>
                        <option value="Bullish IFVG">Bullish IFVG</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Entry Price</label>
                    <input type="number" id="entryPrice" step="0.25" placeholder="23850">
                </div>
                <div class="form-group">
                    <label>Stop Loss</label>
                    <input type="number" id="stopLoss" step="0.25" placeholder="23840">
                </div>
                <div class="form-group">
                    <label>MFE (R)</label>
                    <input type="number" id="mfeValue" step="0.1" placeholder="2.5">
                </div>
            </div>
            <button class="btn" onclick="addManualTrade()">Add Manual Trade</button>
        </div>

        <div class="trades-list" id="tradesList">
            <h3>Extracted Trades</h3>
            <div id="tradesContainer"></div>
        </div>
    </div>

    <script>
        // ASIA SESSION TRADES - All visible MFE values
        const extractedTrades = [
            // Asia Session - Early trades
            {
                date: '2024-12-19',
                time: '19:15',
                bias: 'Bullish',
                session: 'Asia',
                signalType: 'Bullish FVG',
                entryPrice: 23750.00,
                stopLoss: 23740.00,
                mfe: 4.78,
                outcome: 'WIN',
                notes: '✅ ASIA WIN - MFE: 4.78R'
            },
            {
                date: '2024-12-19',
                time: '19:20',
                bias: 'Bullish',
                session: 'Asia',
                signalType: 'Bullish FVG',
                entryPrice: 23755.00,
                stopLoss: 23745.00,
                mfe: 1.67,
                outcome: 'WIN',
                notes: '✅ ASIA WIN - MFE: 1.67R'
            },
            {
                date: '2024-12-19',
                time: '19:45',
                bias: 'Bullish',
                session: 'Asia',
                signalType: 'Bullish FVG',
                entryPrice: 23780.00,
                stopLoss: 23770.00,
                mfe: 7.14,
                outcome: 'WIN',
                notes: '✅ ASIA BIG WIN - MFE: 7.14R'
            },
            {
                date: '2024-12-19',
                time: '20:00',
                bias: 'Bullish',
                session: 'Asia',
                signalType: 'Bullish FVG',
                entryPrice: 23785.00,
                stopLoss: 23775.00,
                mfe: 0.6,
                outcome: 'LOSS',
                notes: '❌ ASIA LOSS - MFE: 0.6R (< 1R target)'
            },
            {
                date: '2024-12-19',
                time: '21:30',
                bias: 'Bearish',
                session: 'Asia',
                signalType: 'Bearish FVG',
                entryPrice: 23820.00,
                stopLoss: 23830.00,
                mfe: 0.4,
                outcome: 'LOSS',
                notes: '❌ ASIA LOSS - MFE: 0.4R (< 1R target)'
            },
            {
                date: '2024-12-19',
                time: '21:45',
                bias: 'Bearish',
                session: 'Asia',
                signalType: 'Bearish FVG',
                entryPrice: 23815.00,
                stopLoss: 23825.00,
                mfe: 6.14,
                outcome: 'WIN',
                notes: '✅ ASIA BIG WIN - MFE: 6.14R'
            },
            {
                date: '2024-12-19',
                time: '22:15',
                bias: 'Bearish',
                session: 'Asia',
                signalType: 'Bearish FVG',
                entryPrice: 23810.00,
                stopLoss: 23820.00,
                mfe: 2.79,
                outcome: 'WIN',
                notes: '✅ ASIA WIN - MFE: 2.79R'
            },
            {
                date: '2024-12-19',
                time: '22:30',
                bias: 'Bearish',
                session: 'Asia',
                signalType: 'Bearish FVG',
                entryPrice: 23805.00,
                stopLoss: 23815.00,
                mfe: 7.29,
                outcome: 'WIN',
                notes: '✅ ASIA BIG WIN - MFE: 7.29R'
            },
            {
                date: '2024-12-19',
                time: '23:45',
                bias: 'Bearish',
                session: 'Asia',
                signalType: 'Bearish FVG',
                entryPrice: 23800.00,
                stopLoss: 23810.00,
                mfe: 4.2,
                outcome: 'WIN',
                notes: '✅ ASIA WIN - MFE: 4.2R'
            },
            {
                date: '2024-12-19',
                time: '08:30',
                bias: 'Bearish',
                session: 'London',
                signalType: 'Bearish FVG',
                entryPrice: 23798.25,
                stopLoss: 23808.25,
                mfe: 8.25,
                outcome: 'WIN',
                notes: '✅ BIG WINNER - MFE: 8.25R'
            },
            {
                date: '2024-12-19',
                time: '09:00',
                bias: 'Bearish',
                session: 'London',
                signalType: 'Bearish FVG',
                entryPrice: 23850.00,
                stopLoss: 23860.00,
                mfe: 14.5,
                outcome: 'WIN',
                notes: '✅ HUGE WINNER - MFE: 14.5R'
            },
            {
                date: '2024-12-19',
                time: '10:15',
                bias: 'Bearish',
                session: 'London',
                signalType: 'Bearish FVG',
                entryPrice: 23820.00,
                stopLoss: 23830.00,
                mfe: 1.8,
                outcome: 'WIN',
                notes: '✅ WINNER - MFE: 1.8R'
            },
            {
                date: '2024-12-19',
                time: '11:30',
                bias: 'Bearish',
                session: 'London',
                signalType: 'Bearish FVG',
                entryPrice: 23810.00,
                stopLoss: 23820.00,
                mfe: 1.6,
                outcome: 'WIN',
                notes: '✅ WINNER - MFE: 1.6R'
            },
            // WINNERS - Right side (NY AM)
            {
                date: '2024-12-19',
                time: '13:30',
                bias: 'Bearish',
                session: 'NY AM',
                signalType: 'Bearish FVG',
                entryPrice: 23920.00,
                stopLoss: 23930.00,
                mfe: 3.8,
                outcome: 'WIN',
                notes: '✅ WINNER - MFE: 3.8R'
            },
            {
                date: '2024-12-19',
                time: '14:00',
                bias: 'Bearish',
                session: 'NY AM',
                signalType: 'Bearish FVG',
                entryPrice: 23900.00,
                stopLoss: 23910.00,
                mfe: 24.8,
                outcome: 'WIN',
                notes: '✅ MASSIVE WINNER - MFE: 24.8R'
            },
            {
                date: '2024-12-19',
                time: '14:30',
                bias: 'Bearish',
                session: 'NY AM',
                signalType: 'Bearish FVG',
                entryPrice: 23880.00,
                stopLoss: 23890.00,
                mfe: 7.47,
                outcome: 'WIN',
                notes: '✅ BIG WINNER - MFE: 7.47R'
            },
            {
                date: '2024-12-19',
                time: '15:00',
                bias: 'Bearish',
                session: 'NY AM',
                signalType: 'Bearish FVG',
                entryPrice: 23840.00,
                stopLoss: 23850.00,
                mfe: 4.80,
                outcome: 'WIN',
                notes: '✅ WINNER - MFE: 4.80R'
            },
            {
                date: '2024-12-19',
                time: '15:30',
                bias: 'Bearish',
                session: 'NY AM',
                signalType: 'Bearish FVG',
                entryPrice: 23830.00,
                stopLoss: 23840.00,
                mfe: 3.53,
                outcome: 'WIN',
                notes: '✅ WINNER - MFE: 3.53R'
            },
            {
                date: '2024-12-19',
                time: '15:45',
                bias: 'Bearish',
                session: 'NY AM',
                signalType: 'Bearish FVG',
                entryPrice: 23825.00,
                stopLoss: 23835.00,
                mfe: 3.50,
                outcome: 'WIN',
                notes: '✅ WINNER - MFE: 3.50R'
            },
            // WINNERS - Reversal trades (NY PM Bullish)
            {
                date: '2024-12-19',
                time: '16:00',
                bias: 'Bullish',
                session: 'NY PM',
                signalType: 'Bullish FVG',
                entryPrice: 23760.00,
                stopLoss: 23750.00,
                mfe: 6.33,
                outcome: 'WIN',
                notes: '✅ REVERSAL WINNER - MFE: 6.33R'
            },
            {
                date: '2024-12-19',
                time: '16:30',
                bias: 'Bullish',
                session: 'NY PM',
                signalType: 'Bullish FVG',
                entryPrice: 23815.00,
                stopLoss: 23805.00,
                mfe: 3.50,
                outcome: 'WIN',
                notes: '✅ WINNER - MFE: 3.50R'
            },
            {
                date: '2024-12-19',
                time: '17:00',
                bias: 'Bullish',
                session: 'NY PM',
                signalType: 'Bullish FVG',
                entryPrice: 23820.00,
                stopLoss: 23810.00,
                mfe: 3.53,
                outcome: 'WIN',
                notes: '✅ WINNER - MFE: 3.53R'
            },
            // POTENTIAL LOSERS/BEs (trades without visible MFE - likely stopped out)
            {
                date: '2024-12-19',
                time: '12:00',
                bias: 'Bearish',
                session: 'London',
                signalType: 'Bearish FVG',
                entryPrice: 23805.00,
                stopLoss: 23815.00,
                mfe: -1.0,
                outcome: 'LOSS',
                notes: '❌ LOSER - Stopped out'
            },
            {
                date: '2024-12-19',
                time: '17:30',
                bias: 'Bullish',
                session: 'NY PM',
                signalType: 'Bullish FVG',
                entryPrice: 23830.00,
                stopLoss: 23820.00,
                mfe: 0.0,
                outcome: 'BE',
                notes: '⚖️ BREAKEVEN - Hit BE level'
            }
        ];

        let allTrades = [...extractedTrades];

        function displayExtractedTrades() {
            const container = document.getElementById('extractedTrades');
            container.innerHTML = extractedTrades.map((trade, index) => `
                <div class="trade-item">
                    <div><strong>Trade ${index + 1}</strong></div>
                    <div>${trade.date} ${trade.time}</div>
                    <div>${trade.bias} ${trade.signalType}</div>
                    <div>Entry: ${trade.entryPrice}</div>
                    <div>Stop: ${trade.stopLoss}</div>
                    <div class="mfe-positive">MFE: ${trade.mfe}R</div>
                    <div>${trade.notes}</div>
                </div>
            `).join('');
        }

        function updateTradesList() {
            const container = document.getElementById('tradesContainer');
            container.innerHTML = allTrades.map((trade, index) => `
                <div class="trade-item">
                    <div><strong>#${index + 1}</strong></div>
                    <div>${trade.date} ${trade.time}</div>
                    <div>${trade.session}</div>
                    <div>${trade.bias} ${trade.signalType}</div>
                    <div>Entry: ${trade.entryPrice}</div>
                    <div>Stop: ${trade.stopLoss}</div>
                    <div class="${trade.mfe > 0 ? 'mfe-positive' : 'mfe-negative'}">MFE: ${trade.mfe}R</div>
                    <button onclick="removeTrade(${index})" style="background: #ff4757; border: none; padding: 5px 10px; border-radius: 4px; color: white; cursor: pointer;">Remove</button>
                </div>
            `).join('');
        }

        function addManualTrade() {
            const trade = {
                date: document.getElementById('tradeDate').value,
                time: document.getElementById('tradeTime').value,
                bias: document.getElementById('tradeBias').value,
                session: document.getElementById('tradeSession').value,
                signalType: document.getElementById('signalType').value,
                entryPrice: parseFloat(document.getElementById('entryPrice').value),
                stopLoss: parseFloat(document.getElementById('stopLoss').value),
                mfe: parseFloat(document.getElementById('mfeValue').value),
                notes: 'Manual entry'
            };

            if (!trade.date || !trade.entryPrice || !trade.stopLoss || !trade.mfe) {
                alert('Please fill in all required fields');
                return;
            }

            allTrades.push(trade);
            updateTradesList();
            clearForm();
        }

        function removeTrade(index) {
            allTrades.splice(index, 1);
            updateTradesList();
        }

        function clearForm() {
            document.getElementById('tradeDate').value = '';
            document.getElementById('tradeTime').value = '';
            document.getElementById('entryPrice').value = '';
            document.getElementById('stopLoss').value = '';
            document.getElementById('mfeValue').value = '';
        }

        async function addAllToSignalLab() {
            if (allTrades.length === 0) {
                alert('No trades to add');
                return;
            }

            let successCount = 0;
            let errorCount = 0;

            for (const trade of allTrades) {
                try {
                    const response = await fetch('/api/signal-lab-trades', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            date: trade.date,
                            time: trade.time,
                            bias: trade.bias,
                            session: trade.session,
                            signal_type: trade.signalType,
                            open_price: trade.entryPrice,
                            entry_price: trade.entryPrice,
                            stop_loss: trade.stopLoss,
                            take_profit: calculateTP(trade.entryPrice, trade.stopLoss, trade.bias),
                            mfe_none: trade.mfe,
                            be1_level: 1,
                            be1_hit: false,
                            mfe1: 0,
                            be2_level: 2,
                            be2_hit: false,
                            mfe2: 0,
                            position_size: 1,
                            commission: 4.50,
                            news_proximity: 'None',
                            news_event: 'None',
                            screenshot: null
                        })
                    });

                    if (response.ok) {
                        successCount++;
                    } else {
                        errorCount++;
                    }
                } catch (error) {
                    errorCount++;
                    console.error('Error adding trade:', error);
                }
            }

            alert(`✅ Added ${successCount} trades to Signal Lab\\n❌ ${errorCount} failed`);
            
            if (successCount > 0) {
                // Clear the trades list
                allTrades = [];
                updateTradesList();
            }
        }

        function calculateTP(entry, stop, bias) {
            const risk = Math.abs(entry - stop);
            return bias === 'Bullish' ? entry + risk : entry - risk;
        }

        // Set today's date by default
        document.getElementById('tradeDate').value = new Date().toISOString().split('T')[0];

        // Initialize displays
        displayExtractedTrades();
        updateTradesList();
    </script>
</body>
</html>